import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.b81f03d3.js";const F=JSON.parse('{"title":"ğŸ“ æ’ä»¶å¼€å‘æŒ‡å—","description":"","frontmatter":{},"headers":[],"relativePath":"dev/basic.md","filePath":"dev/basic.md","lastUpdated":1698582654000}'),p={name:"dev/basic.md"},o=l(`<h1 id="ğŸ“-æ’ä»¶å¼€å‘æŒ‡å—" tabindex="-1">ğŸ“ æ’ä»¶å¼€å‘æŒ‡å— <a class="header-anchor" href="#ğŸ“-æ’ä»¶å¼€å‘æŒ‡å—" aria-label="Permalink to &quot;ğŸ“ æ’ä»¶å¼€å‘æŒ‡å—&quot;">â€‹</a></h1><p>æœ¬æ–‡æ‰€ç”¨ç¤ºä¾‹æ’ä»¶åº“: <a href="https://github.com/LlmKira/llmbot_plugin_bilisearch" target="_blank" rel="noreferrer">https://github.com/LlmKira/llmbot_plugin_bilisearch</a></p><p>OpenaiBot ä¸ºç¬¬ä¸‰æ–¹æ’ä»¶æä¾›äº† OPENAPI æ¥å£æ³¨å†Œç³»ç»Ÿï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•å»ºé€ ä¸€ä¸ªæ’ä»¶ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å› ä¸ºæ’ä»¶æœºåˆ¶æ˜¯å‚è€ƒ <code>Nonebot</code> å®ç°ï¼Œæ•…æ’ä»¶å¼€å‘å’Œ NoneBot Plugin è¿‘ä¼¼ã€‚</p></div><h2 id="ğŸ“Œ-ç»“æ„è§„èŒƒ" tabindex="-1">ğŸ“Œ ç»“æ„è§„èŒƒ <a class="header-anchor" href="#ğŸ“Œ-ç»“æ„è§„èŒƒ" aria-label="Permalink to &quot;ğŸ“Œ ç»“æ„è§„èŒƒ&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">åŸºç¡€ç»“æ„ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#e1e4e8;">â”œâ”€â”€ LICENSE</span></span>
<span class="line"><span style="color:#e1e4e8;">â”œâ”€â”€ llmbot_plugin_bilisearch</span></span>
<span class="line"><span style="color:#e1e4e8;">â”‚       â””â”€ __init__.py</span></span>
<span class="line"><span style="color:#e1e4e8;">â”œâ”€â”€ poetry.lock</span></span>
<span class="line"><span style="color:#e1e4e8;">â”œâ”€â”€ pyproject.toml</span></span>
<span class="line"><span style="color:#e1e4e8;">â””â”€â”€ README.md</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">åŸºç¡€ç»“æ„ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#24292e;">â”œâ”€â”€ LICENSE</span></span>
<span class="line"><span style="color:#24292e;">â”œâ”€â”€ llmbot_plugin_bilisearch</span></span>
<span class="line"><span style="color:#24292e;">â”‚       â””â”€ __init__.py</span></span>
<span class="line"><span style="color:#24292e;">â”œâ”€â”€ poetry.lock</span></span>
<span class="line"><span style="color:#24292e;">â”œâ”€â”€ pyproject.toml</span></span>
<span class="line"><span style="color:#24292e;">â””â”€â”€ README.md</span></span></code></pre></div><p><code>README.md</code> æ˜¯é¡¹ç›®çš„è¯´æ˜æ–‡ä»¶ã€‚</p><p><code>pyproject.toml</code> æ˜¯é¡¹ç›®çš„åŒ…ä¿¡æ¯æ–‡ä»¶ï¼ŒåŒ…å«åŒ…çš„åç§°ï¼Œä¾èµ–,å’Œä½œè€…ï¼Œä¸»é¡µç­‰é…ç½®ã€‚æŸ¥çœ‹<a href="https://python-poetry.org/docs/pyproject/" target="_blank" rel="noreferrer">è¯¦ç»†é€‰é¡¹</a>ã€‚</p><p><code>poetry.lock</code> æ˜¯é¡¹ç›®ä¾èµ–é”æ–‡ä»¶ï¼Œé”å®šä»“åº“ä¾èµ–ç‰ˆæœ¬ï¼Œè®©æ‰€æœ‰åä½œè€…éƒ½ä½¿ç”¨ç»Ÿä¸€ç‰ˆæœ¬ä¾èµ–ã€‚æ­¤æ–‡ä»¶åœ¨æ›´æ–°ä¾èµ–ç‰ˆæœ¬æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ <code>poetry lock</code> å‘½ä»¤æ›´æ–°ã€‚</p><p><code>llmbot_plugin_bilisearch</code> æ˜¯ç¤ºä¾‹ä¸­æ’ä»¶çš„ä¸»ä½“ï¼Œå†…å«æ’ä»¶çš„çœŸæ­£æ‰§è¡Œæ–‡ä»¶å’Œèµ„æºã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å› ä¸º pypi ä¸å…è®¸ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œæ•…æ’ä»¶æ‰“åŒ…æ–‡ä»¶å¤¹ä¸åº”ä¸Šä¼ è¾ƒå¤§èµ„æºæ–‡ä»¶ã€‚</p></div><p><code>LICENSE</code> æ˜¯é¡¹ç›®çš„å¼€æºåè®®æ–‡ä»¶ï¼Œå…·æœ‰ä¸€å®šæ³•å¾‹æ•ˆåŠ›ã€‚é€‰æ‹©åè®®å¯ä»¥å‚è€ƒ <a href="https://www.zhihu.com/question/19568896" target="_blank" rel="noreferrer">çŸ¥ä¹é—®é¢˜</a>ã€‚</p><h3 id="ğŸ”—-å¯¼å…¥éªŒè¯" tabindex="-1">ğŸ”— å¯¼å…¥éªŒè¯ <a class="header-anchor" href="#ğŸ”—-å¯¼å…¥éªŒè¯" aria-label="Permalink to &quot;ğŸ”— å¯¼å…¥éªŒè¯&quot;">â€‹</a></h3><p>é¦–å…ˆç¡®è®¤æ‚¨å®‰è£…äº†ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼ŒPython ç¯å¢ƒ(ç‰ˆæœ¬å¤§äº3.9)ã€‚åœ¨ Shellæ§åˆ¶å° æˆ– CMDå‘½ä»¤è¡Œ è¾“å…¥ <code>python -v</code> æ£€æŸ¥æˆ–æŸ¥çœ‹ç‰ˆæœ¬ã€‚</p><h4 id="ä¸‹è½½æ‰€éœ€çš„å·¥å…·" tabindex="-1">ä¸‹è½½æ‰€éœ€çš„å·¥å…· <a class="header-anchor" href="#ä¸‹è½½æ‰€éœ€çš„å·¥å…·" aria-label="Permalink to &quot;ä¸‹è½½æ‰€éœ€çš„å·¥å…·&quot;">â€‹</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">llmkira</span></span>
<span class="line"><span style="color:#B392F0;">pip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">poetry</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">llmkira</span></span>
<span class="line"><span style="color:#6F42C1;">pip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">poetry</span></span></code></pre></div><p><code>llmkira</code> æ˜¯æœºå™¨äººä¸»ä½“æ–‡ä»¶çš„æ‰“åŒ…é›†åˆï¼Œæ’ä»¶éœ€è¦å¯¼å…¥å…¶ä¸­çš„ç±»è¿›è¡Œä½¿ç”¨ã€‚è¿™é‡Œæœ‰å¯¼å…¥çš„<a href="https://github.com/LlmKira/llmbot_plugin_bilisearch/blob/main/llmbot_plugin_bilisearch/__init__.py" target="_blank" rel="noreferrer">ç¤ºä¾‹</a>ã€‚</p><p><code>poetry</code> æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ä¾èµ–ç®¡ç†å’Œæ‰“åŒ…çš„å·¥å…·ã€‚<a href="https://python-poetry.org/docs/basic-usage/" target="_blank" rel="noreferrer">åŸºç¡€å‘½ä»¤ä»‹ç»</a>ã€‚</p><div class="info custom-block"><p class="custom-block-title">å¸¸ç”¨å‘½ä»¤</p><ul><li><code>poetry init</code> åˆ›å»ºä¸€ä¸ª <code>pyproject.toml</code> æ–‡ä»¶</li><li><code>poetry lock</code> æ›´æ–°ä¾èµ–é”</li><li><code>poetry add &lt;name&gt;</code> æ·»åŠ ä¾èµ–</li><li><code>poetry install</code> å®‰è£…å½“å‰åº“åˆ°æœ¬åœ°ç¯å¢ƒ</li><li><code>poetry build</code> æ„å»ºåº“</li><li><code>poetry publish</code> å‘å¸ƒåº“</li></ul></div><p>åœ¨ Github æ–°å»ºé¡¹ç›®å¹¶æ‹‰å–æœ¬åœ°ã€‚</p><p>ç”¨ä»£ç ç¼–è¾‘å™¨æ‰“å¼€æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå†å»ºç«‹æ’ä»¶æ–‡ä»¶å¤¹ï¼Œåœ¨å½“å‰é¡¹ç›®ä½ç½®æ‰“å¼€ Shell è¾“å…¥ <code>poetry init</code> å»ºç«‹åŸºç¡€åŒ…ç»“æ„ã€‚</p><p>è¾“å…¥æ‰€éœ€ä¿¡æ¯å®Œå–„ <code>pyproject.toml</code> æ–‡ä»¶ã€‚</p><p>ä½¿ç”¨ <code>poetry add &lt;some&gt;</code> å‘½ä»¤æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶æ·»åŠ ä¾èµ–ã€‚</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">tool</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">poetry</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">dependencies</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">python = </span><span style="color:#9ECBFF;">&quot;^3.9&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">bilibili-api-python = </span><span style="color:#9ECBFF;">&quot;^16.1.0&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#6F42C1;">tool</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">poetry</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">dependencies</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">python = </span><span style="color:#032F62;">&quot;^3.9&quot;</span></span>
<span class="line"><span style="color:#24292E;">bilibili-api-python = </span><span style="color:#032F62;">&quot;^16.1.0&quot;</span></span></code></pre></div><p>è‡³æ­¤ï¼Œé¡¹ç›®åŸºæœ¬ç»“æ„å·²ç»å»ºç«‹ã€‚</p><h2 id="ğŸ“¦-å¼€å‘æµç¨‹" tabindex="-1">ğŸ“¦ å¼€å‘æµç¨‹ <a class="header-anchor" href="#ğŸ“¦-å¼€å‘æµç¨‹" aria-label="Permalink to &quot;ğŸ“¦ å¼€å‘æµç¨‹&quot;">â€‹</a></h2><p>æ’ä»¶å†…éƒ¨ç”± å‡½æ•°ç±»ï¼Œå·¥å…·ç±»ï¼Œå…ƒä¿¡æ¯ï¼ŒåŠŸèƒ½å‡½æ•°ï¼Œå‚æ•°æ ¡éªŒç±» ç»„æˆã€‚</p><p>å‡½æ•°å†…æ’ä»¶åç§°<strong>å¿…é¡»</strong>ç”± <code>__plugin_name__</code> å‚æ•°å¼•ç”¨ã€‚</p><h3 id="ğŸª£-æ·»åŠ å˜é‡ä¸éªŒè¯" tabindex="-1">ğŸª£ æ·»åŠ å˜é‡ä¸éªŒè¯ <a class="header-anchor" href="#ğŸª£-æ·»åŠ å˜é‡ä¸éªŒè¯" aria-label="Permalink to &quot;ğŸª£ æ·»åŠ å˜é‡ä¸éªŒè¯&quot;">â€‹</a></h3><p><strong>ä¸‹é¢çš„ä»£ç å¿…é¡»æ”¾è¿›å¼€å¤´è¿›è¡Œæ¶æ„ç‰ˆæœ¬éªŒè¯ã€‚</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">__package_name__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;llmbot_plugin_bilisearch&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">__plugin_name__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">__openapi_version__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;20231017&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> llmkira.sdk.func_calling </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> verify_openapi_version</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#E1E4E8;">verify_openapi_version(__package_name__, __openapi_version__)  </span><span style="color:#6A737D;"># éªŒè¯ </span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">__package_name__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;llmbot_plugin_bilisearch&quot;</span></span>
<span class="line"><span style="color:#24292E;">__plugin_name__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"><span style="color:#24292E;">__openapi_version__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;20231017&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> llmkira.sdk.func_calling </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> verify_openapi_version</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#24292E;">verify_openapi_version(__package_name__, __openapi_version__)  </span><span style="color:#6A737D;"># éªŒè¯ </span></span></code></pre></div><h3 id="âš™ï¸-å®šä¹‰å‡½æ•°ç±»" tabindex="-1">âš™ï¸ å®šä¹‰å‡½æ•°ç±» <a class="header-anchor" href="#âš™ï¸-å®šä¹‰å‡½æ•°ç±»" aria-label="Permalink to &quot;âš™ï¸ å®šä¹‰å‡½æ•°ç±»&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">__plugin_name__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> llmkira.sdk.endpoint.openai </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Function</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">bilibili </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Function(</span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;Search videos on bilibili.com(å“”å“©å“”å“©)&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FFAB70;">config</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Function.FunctionExtra(</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#FFAB70;">system_prompt</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,  </span><span style="color:#6A737D;"># å¦‚æœè£…è½½åˆ°äº†/ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="color:#E1E4E8;">                    ),</span></span>
<span class="line"><span style="color:#E1E4E8;">                    )</span></span>
<span class="line"><span style="color:#E1E4E8;">bilibili.add_property(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">property_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;keywords&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">property_description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;Keywords entered in the search box&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">property_type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;string&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">required</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">__plugin_name__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> llmkira.sdk.endpoint.openai </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Function</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">bilibili </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Function(</span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">__plugin_name__,</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Search videos on bilibili.com(å“”å“©å“”å“©)&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#E36209;">config</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">Function.FunctionExtra(</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#E36209;">system_prompt</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,  </span><span style="color:#6A737D;"># å¦‚æœè£…è½½åˆ°äº†/ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="color:#24292E;">                    ),</span></span>
<span class="line"><span style="color:#24292E;">                    )</span></span>
<span class="line"><span style="color:#24292E;">bilibili.add_property(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">property_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;keywords&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">property_description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Keywords entered in the search box&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">property_type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;string&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">required</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre></div><p>è¿™é‡Œçš„ä¿¡æ¯ä¼šè¢«æäº¤ç»™LLMä½¿ç”¨ï¼Œä½ å¯ä»¥è¿ç”¨ <code>Prompt å·¥ç¨‹</code> æ¥æ”¹è¿›ä»–ä»¬ã€‚</p><p><code>required</code> å±æ€§ä¸ä¸€å®šæœ‰æ•ˆã€‚</p><h3 id="ğŸ©¼-æ·»åŠ å‡½æ•°æ ¡éªŒç±»" tabindex="-1">ğŸ©¼ æ·»åŠ å‡½æ•°æ ¡éªŒç±» <a class="header-anchor" href="#ğŸ©¼-æ·»åŠ å‡½æ•°æ ¡éªŒç±»" aria-label="Permalink to &quot;ğŸ©¼ æ·»åŠ å‡½æ•°æ ¡éªŒç±»&quot;">â€‹</a></h3><p>åœ¨å®é™…æƒ…å†µä¸­ï¼Œå³ä½¿æ‚¨çš„å‡½æ•°å®šä¹‰äº†å‚æ•° required=Trueï¼Œä½†æ˜¯è¿”å›ä¹Ÿå¯èƒ½æ˜¯ Noneï¼Œæ•…æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‚æ•°æ ¡éªŒç±»æ¥æ£€æŸ¥å‚æ•°ã€‚</p><p>å€ŸåŠ©äº <a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noreferrer">pydantic</a> ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å‚æ•°æ ¡éªŒã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-focused-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pydantic </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> BaseModel</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Bili</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">BaseModel</span><span style="color:#E1E4E8;">):  </span><span style="color:#6A737D;"># å‚æ•° </span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#E1E4E8;">    keywords: </span><span style="color:#79B8FF;">str</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Config</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    extra </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;allow&quot;</span></span></code></pre><pre class="shiki github-light has-focused-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pydantic </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> BaseModel</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Bili</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">BaseModel</span><span style="color:#24292E;">):  </span><span style="color:#6A737D;"># å‚æ•° </span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#24292E;">    keywords: </span><span style="color:#005CC5;">str</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Config</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    extra </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;allow&quot;</span></span></code></pre></div><p>è¯·æ‚¨åœ¨ å·¥å…·ç±» çš„ <code>run</code> æ–¹æ³•ä¸­ä½¿ç”¨ pydantic åšå‚æ•°æ ¡éªŒã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-focused-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">try</span><span style="color:#E1E4E8;">:</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">    _set </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Bili.parse_obj(arg)  </span><span style="color:#6A737D;"># </span></span>
<span class="line has-focus"><span style="color:#F97583;">except</span><span style="color:#E1E4E8;">:</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># failed</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">pass</span></span></code></pre><pre class="shiki github-light has-focused-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">try</span><span style="color:#24292E;">:</span></span>
<span class="line has-focus"><span style="color:#24292E;">    _set </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Bili.parse_obj(arg)  </span><span style="color:#6A737D;"># </span></span>
<span class="line has-focus"><span style="color:#D73A49;">except</span><span style="color:#24292E;">:</span></span>
<span class="line has-focus"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># failed</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span></code></pre></div><h3 id="âš“ï¸-åŠŸèƒ½å‡½æ•°" tabindex="-1">âš“ï¸ åŠŸèƒ½å‡½æ•° <a class="header-anchor" href="#âš“ï¸-åŠŸèƒ½å‡½æ•°" aria-label="Permalink to &quot;âš“ï¸ åŠŸèƒ½å‡½æ•°&quot;">â€‹</a></h3><p>åŠŸèƒ½å‡½æ•°å°±æ˜¯ä¸€ä¸ªå®ç°åŠŸèƒ½çš„å‡½æ•°ã€‚éšä¾¿ä½ æ€ä¹ˆå†™ã€‚</p><p>æ­¤å‡½æ•°è‡ªç”±å‘æŒ¥ï¼Œä½†æ˜¯ä¹‹åçš„OPENAPIæ¶æ„éœ€è¦åŒ¹é…ä¸€ä¸ªé”™è¯¯è£…é¥°å™¨æ¥è®¡æ•°é”™è¯¯ã€‚</p><p>æ•…æ¨èç¼–å†™ä¸€ä¸ªä¸»å‡½æ•°ä¾¿äºåç»­å‡çº§ã€‚</p><h3 id="ğŸ­-å·¥å…·ç±»" tabindex="-1">ğŸ­ å·¥å…·ç±» <a class="header-anchor" href="#ğŸ­-å·¥å…·ç±»" aria-label="Permalink to &quot;ğŸ­ å·¥å…·ç±»&quot;">â€‹</a></h3><p>æ‰€æœ‰å·¥å…·ç±»å¿…é¡»ç»§æ‰¿ <a href="https://github.com/LlmKira/Openaibot/blob/main/llmkira/sdk/func_calling/schema.py#L14" target="_blank" rel="noreferrer">BaseTool</a>ã€‚</p><p>å…·ä½“å†™æ³•è§ä¸‹ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> re</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> abc </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ABC</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> typing </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Optional, List, Union, Literal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pydantic </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> BaseModel, Field</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BaseTool</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">ABC</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">BaseModel</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">    åŸºç¡€å·¥å…·ç±»ï¼Œæ‰€æœ‰å·¥å…·ç±»éƒ½åº”è¯¥ç»§æ‰¿æ­¤ç±»</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    silent: </span><span style="color:#79B8FF;">bool</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;æ˜¯å¦é™é»˜&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    function: Function </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">...</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;åŠŸèƒ½&quot;</span><span style="color:#E1E4E8;">)  </span><span style="color:#6A737D;"># å‡½æ•°ç±»ä¼ å…¥ </span></span>
<span class="line"><span style="color:#E1E4E8;">    keywords: List[</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field([], </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;å…³é”®è¯&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    pattern: Optional[re.Pattern] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;æ­£åˆ™åŒ¹é…&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    require_auth: </span><span style="color:#79B8FF;">bool</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;æ˜¯å¦éœ€è¦æˆæƒ&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    repeatable: </span><span style="color:#79B8FF;">bool</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;æ˜¯å¦å¯é‡å¤ä½¿ç”¨&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    deploy_child: Literal[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;å¦‚æœä¸º0ï¼Œç»ˆç»“äºæ­¤é“¾ç‚¹ï¼Œä¸å†å‘ä¸‹ä¼ é€’&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    require_auth_kwargs: </span><span style="color:#79B8FF;">dict</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    env_required: List[</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field([], </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;ç¯å¢ƒå˜é‡è¦æ±‚&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    file_match_required: Optional[re.Pattern] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;re.compile æ–‡ä»¶åæ­£åˆ™&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">env_help_docs</span><span style="color:#E1E4E8;">(self, empty_env: List[</span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">]) -&gt; </span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">        ç¯å¢ƒå˜é‡å¸®åŠ©æ–‡æ¡£</span></span>
<span class="line"><span style="color:#9ECBFF;">        :param empty_env: æœªè¢«é…ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span style="color:#9ECBFF;">        :return: å¸®åŠ©æ–‡æ¡£/è­¦å‘Š</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">assert</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">isinstance</span><span style="color:#E1E4E8;">(empty_env, </span><span style="color:#79B8FF;">list</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&quot;empty_env must be list&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;You need to configure ENV to start use this tool&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">func_message</span><span style="color:#E1E4E8;">(self, message_text):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># è§„åˆ™æ£€æŸ¥ï¼Œå¦‚æœè¿”å›Trueåˆ™åœ¨è¯·æ±‚ä¸­å€™é€‰å®ƒ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pre_check</span><span style="color:#E1E4E8;">(self) -&gt; Union[</span><span style="color:#79B8FF;">bool</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">]:  </span><span style="color:#6A737D;"># é¢„æ£€æŸ¥ï¼Œå¦‚æœä¸åˆæ ¼åˆ™è¿”å›Falseï¼Œåˆæ ¼åˆ™è¿”å›True</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">        å­—ç¬¦ä¸²è¡¨ç¤º {false,reason}</span></span>
<span class="line"><span style="color:#9ECBFF;">        :return: bool | str(error message)</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(self, task, receiver, arg, </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">kwargs):  </span><span style="color:#6A737D;"># è¿è¡Œä¸»å‡½æ•° </span></span>
<span class="line"><span style="color:#E1E4E8;">        env </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> kwargs.get(</span><span style="color:#9ECBFF;">&quot;env&quot;</span><span style="color:#E1E4E8;">, {})</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">failed</span><span style="color:#E1E4E8;">(self, platform, task, receiver, reason):  </span><span style="color:#6A737D;"># å¤±è´¥è°ƒç”¨ï¼Œè¦è‡ªå·±åœ¨ run é‡Œé¢è°ƒç”¨å“¦ã€‚ </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> re</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> abc </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ABC</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> typing </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Optional, List, Union, Literal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pydantic </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> BaseModel, Field</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BaseTool</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">ABC</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">BaseModel</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">    åŸºç¡€å·¥å…·ç±»ï¼Œæ‰€æœ‰å·¥å…·ç±»éƒ½åº”è¯¥ç»§æ‰¿æ­¤ç±»</span></span>
<span class="line"><span style="color:#032F62;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    silent: </span><span style="color:#005CC5;">bool</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;æ˜¯å¦é™é»˜&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line diff add"><span style="color:#24292E;">    function: Function </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">...</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;åŠŸèƒ½&quot;</span><span style="color:#24292E;">)  </span><span style="color:#6A737D;"># å‡½æ•°ç±»ä¼ å…¥ </span></span>
<span class="line"><span style="color:#24292E;">    keywords: List[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field([], </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;å…³é”®è¯&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    pattern: Optional[re.Pattern] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;æ­£åˆ™åŒ¹é…&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    require_auth: </span><span style="color:#005CC5;">bool</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;æ˜¯å¦éœ€è¦æˆæƒ&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    repeatable: </span><span style="color:#005CC5;">bool</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;æ˜¯å¦å¯é‡å¤ä½¿ç”¨&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    deploy_child: Literal[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;å¦‚æœä¸º0ï¼Œç»ˆç»“äºæ­¤é“¾ç‚¹ï¼Œä¸å†å‘ä¸‹ä¼ é€’&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    require_auth_kwargs: </span><span style="color:#005CC5;">dict</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {}</span></span>
<span class="line"><span style="color:#24292E;">    env_required: List[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field([], </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;ç¯å¢ƒå˜é‡è¦æ±‚&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    file_match_required: Optional[re.Pattern] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">, </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;re.compile æ–‡ä»¶åæ­£åˆ™&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">env_help_docs</span><span style="color:#24292E;">(self, empty_env: List[</span><span style="color:#005CC5;">str</span><span style="color:#24292E;">]) -&gt; </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        ç¯å¢ƒå˜é‡å¸®åŠ©æ–‡æ¡£</span></span>
<span class="line"><span style="color:#032F62;">        :param empty_env: æœªè¢«é…ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span>
<span class="line"><span style="color:#032F62;">        :return: å¸®åŠ©æ–‡æ¡£/è­¦å‘Š</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">assert</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isinstance</span><span style="color:#24292E;">(empty_env, </span><span style="color:#005CC5;">list</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&quot;empty_env must be list&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;You need to configure ENV to start use this tool&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">func_message</span><span style="color:#24292E;">(self, message_text):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># è§„åˆ™æ£€æŸ¥ï¼Œå¦‚æœè¿”å›Trueåˆ™åœ¨è¯·æ±‚ä¸­å€™é€‰å®ƒ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pre_check</span><span style="color:#24292E;">(self) -&gt; Union[</span><span style="color:#005CC5;">bool</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">]:  </span><span style="color:#6A737D;"># é¢„æ£€æŸ¥ï¼Œå¦‚æœä¸åˆæ ¼åˆ™è¿”å›Falseï¼Œåˆæ ¼åˆ™è¿”å›True</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        å­—ç¬¦ä¸²è¡¨ç¤º {false,reason}</span></span>
<span class="line"><span style="color:#032F62;">        :return: bool | str(error message)</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(self, task, receiver, arg, </span><span style="color:#D73A49;">**</span><span style="color:#24292E;">kwargs):  </span><span style="color:#6A737D;"># è¿è¡Œä¸»å‡½æ•° </span></span>
<span class="line"><span style="color:#24292E;">        env </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kwargs.get(</span><span style="color:#032F62;">&quot;env&quot;</span><span style="color:#24292E;">, {})</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">failed</span><span style="color:#24292E;">(self, platform, task, receiver, reason):  </span><span style="color:#6A737D;"># å¤±è´¥è°ƒç”¨ï¼Œè¦è‡ªå·±åœ¨ run é‡Œé¢è°ƒç”¨å“¦ã€‚ </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><code>callback</code> å‡½æ•°æš‚æ—¶æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚</p></div><p>æ„å»ºå…³é”®è¯å‚æ•°æ—¶è¯·è€ƒè™‘å›½é™…åŒ–ï¼Œä¸”å°½é‡é¿å¼€å…¬å…±å…³é”®è¯ï¼Œç¦æ­¢ä½¿ç”¨å•å­—å…³é”®è¯ã€‚</p><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>ç»§æ‰¿ <code>BaseTool</code> ç±»åï¼Œ<strong>ç¦æ­¢å®šä¹‰ <code>__init__</code></strong></p></div><h4 id="ğŸ³-åŠ¨æ€æ¿€æ´»" tabindex="-1">ğŸ³ åŠ¨æ€æ¿€æ´» <a class="header-anchor" href="#ğŸ³-åŠ¨æ€æ¿€æ´»" aria-label="Permalink to &quot;ğŸ³ åŠ¨æ€æ¿€æ´»&quot;">â€‹</a></h4><p>æ¯æ¬¡å¯¹è¯é€è¾¾åï¼Œä¼šé‡æ–°æ ¹æ®ç”¨æˆ·è¯­æ–™æ„å»ºæ–°çš„å‡½æ•°è¡¨ã€‚ æ’ä»¶é€‰æ‹©å™¨ä¼šæ ¹æ®å­—ç¬¦åŒ¹é…ç¡®å®šå“ªäº›æ˜¯å€™é€‰å‡½æ•°ï¼Œ <code>keywords</code> å’Œ <code>pattern</code> å‚æ•°å†³å®šäº†æ­¤æ¬¡å¯¹è¯æ˜¯å¦å€™é€‰æ­¤å‡½æ•°ã€‚</p><p><code>func_message</code> å‡½æ•°å†³å®šäº†æ˜¯å¦æ¿€æ´»æ­¤å‡½æ•°ã€‚</p><p><code>file_match_required</code> è¢«å®šä¹‰åï¼Œä¼šåœ¨æ–‡ä»¶æ¶ˆæ¯ä¸­è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™æ¿€æ´»æ­¤å‡½æ•°ï¼Œå¦åˆ™ç¦ç”¨ï¼</p><p><code>deploy_child</code> å‚æ•°å†³å®šäº†æ­¤å‡½æ•°æ˜¯å¦ç»§ç»­å‘ä¸‹ä¼ é€’ï¼ˆç»“æŸæ ‡è®°ï¼‰ã€‚</p><p>æ¯æ¬¡é€’å½’ï¼Œä¸Šæ¬¡çš„å‡½æ•°ä¼šè¢«å¿½ç•¥ï¼Œå¦‚æœå¸Œæœ›å‡½æ•°å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå¯ä»¥è®¾ç½® <code>repeatable</code> å±æ€§ã€‚</p><p>é»˜è®¤é“¾é€’å½’æ·±åº¦ä¸º 6ï¼Œé€šè¿‡ <code>limit_child</code> å±æ€§å®šä¹‰ã€‚<strong>æ’ä»¶ç¦æ­¢é‡æ–°å®šä¹‰æ­¤å‚æ•°ã€‚</strong></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>æ–°å¯¹è¯é“¾è¢«å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç»§æ‰¿ä¸Šä¸€ä¸ªå¯¹è¯é“¾çš„å‡½æ•°å±æ€§ã€‚</p></div><h4 id="ğŸ§ƒ-env-å£°æ˜æˆæƒç³»ç»Ÿ" tabindex="-1">ğŸ§ƒ Env å£°æ˜æˆæƒç³»ç»Ÿ <a class="header-anchor" href="#ğŸ§ƒ-env-å£°æ˜æˆæƒç³»ç»Ÿ" aria-label="Permalink to &quot;ğŸ§ƒ Env å£°æ˜æˆæƒç³»ç»Ÿ&quot;">â€‹</a></h4><ul><li>å£°æ˜</li></ul><p>è®¾ç½® <code>env_required</code> å±æ€§ï¼Œå£°æ˜éœ€è¦çš„å¸¸é‡ã€‚</p><ul><li>è®¾ç½®æ–‡æ¡£</li></ul><p>å­ç±»é‡å†™ <code>env_help_docs</code> å‡½æ•°ï¼Œè¿”å›å¸®åŠ©æ–‡æ¡£ã€‚æ­¤æ–‡æ¡£ä¼šåœ¨ç¼ºå¤±å˜é‡æ—¶è°ƒç”¨ï¼Œè¢«å‘é€ç»™ç”¨æˆ·ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(self, task, receiver, arg, </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="color:#E1E4E8;">    env </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> kwargs.get(</span><span style="color:#9ECBFF;">&quot;env&quot;</span><span style="color:#E1E4E8;">, {})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(self, task, receiver, arg, </span><span style="color:#D73A49;">**</span><span style="color:#24292E;">kwargs):</span></span>
<span class="line"><span style="color:#24292E;">    env </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> kwargs.get(</span><span style="color:#032F62;">&quot;env&quot;</span><span style="color:#24292E;">, {})</span></span></code></pre></div><h3 id="ğŸ¥„-æ³¨å†Œå…ƒä¿¡æ¯" tabindex="-1">ğŸ¥„ æ³¨å†Œå…ƒä¿¡æ¯ <a class="header-anchor" href="#ğŸ¥„-æ³¨å†Œå…ƒä¿¡æ¯" aria-label="Permalink to &quot;ğŸ¥„ æ³¨å†Œå…ƒä¿¡æ¯&quot;">â€‹</a></h3><p>æ ¸å¿ƒç±» <code>PluginMetadata</code> ï¼Œæ‚¨å¯ä»¥åœ¨ <a href="https://github.com/LlmKira/Openaibot/blob/main/llmkira/sdk/func_calling/schema.py#L84" target="_blank" rel="noreferrer">è¿™é‡Œ</a> æŸ¥çœ‹å®ƒçš„ç»„æˆç»“æ„ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># åç§°</span></span>
<span class="line"><span style="color:#E1E4E8;">__plugin_name__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸­é—´æ˜¯å‡½æ•°ä»£ç ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ ¸å¿ƒå…ƒä¿¡æ¯</span></span>
<span class="line"><span style="color:#E1E4E8;">__plugin_meta__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PluginMetadata(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;Search videos on bilibili.com(å“”å“©å“”å“©)&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">usage</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;search &lt;keywords&gt;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">openapi_version</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">__openapi_version__,  </span><span style="color:#6A737D;"># OPENAPI ç‰ˆæœ¬ </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">function</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">        FuncPair(</span><span style="color:#FFAB70;">function</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">bilibili, </span><span style="color:#FFAB70;">tool</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">BiliBiliSearch)  </span><span style="color:#6A737D;"># å‡½æ•°ç±»å’Œå·¥å…·ç±»</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#6A737D;"># åç§°</span></span>
<span class="line"><span style="color:#24292E;">__plugin_name__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;search_in_bilibili&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ä¸­é—´æ˜¯å‡½æ•°ä»£ç ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># æ ¸å¿ƒå…ƒä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">__plugin_meta__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PluginMetadata(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">__plugin_name__,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;Search videos on bilibili.com(å“”å“©å“”å“©)&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">usage</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;search &lt;keywords&gt;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#E36209;">openapi_version</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">__openapi_version__,  </span><span style="color:#6A737D;"># OPENAPI ç‰ˆæœ¬ </span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#E36209;">function</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{</span></span>
<span class="line diff add"><span style="color:#24292E;">        FuncPair(</span><span style="color:#E36209;">function</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">bilibili, </span><span style="color:#E36209;">tool</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">BiliBiliSearch)  </span><span style="color:#6A737D;"># å‡½æ•°ç±»å’Œå·¥å…·ç±»</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>FuncPair</code> ç»‘å®š <code>function</code> å‡½æ•°ç±»å’Œ <code>tool</code> å·¥å…·ç±»ã€‚</p></div><p><code>openapi_version</code> å‚æ•°è®°å½•å½“å‰åŒæ­¥ç‰ˆæœ¬ï¼Œå¦‚æœå®¿ä¸»æ¡†æ¶æ›´æ–°ï¼ŒPlugin å¯èƒ½éœ€è¦åŒæ­¥æ­¤å‚æ•°ä»¥æ”¯æŒæ–°æ¥å£ã€‚</p><div class="tip custom-block"><p class="custom-block-title">ä»€ä¹ˆæ—¶å€™éœ€è¦æ›´æ–°æˆ‘çš„æ’ä»¶ï¼Ÿ</p><p>OpenAPI ç»„ä»¶ä¼šè®¾å®šå“ªäº›ç‰ˆæœ¬çš„æ’ä»¶å¯ä»¥è¢«åŠ è½½ï¼Œå¦‚æœæ‚¨çš„æ’ä»¶ç‰ˆæœ¬è¿‡ä½ï¼Œä¼šæŠ¥é”™ï¼Œå±Šæ—¶æ‚¨å°†æ”¶åˆ°ç”¨æˆ·çš„ Issueã€‚</p></div><h3 id="ğŸ¥¥-å‰éªŒè§¦å‘å™¨" tabindex="-1">ğŸ¥¥ å‰éªŒè§¦å‘å™¨ <a class="header-anchor" href="#ğŸ¥¥-å‰éªŒè§¦å‘å™¨" aria-label="Permalink to &quot;ğŸ¥¥ å‰éªŒè§¦å‘å™¨&quot;">â€‹</a></h3><p>ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨æ¥é˜»æ­¢æˆ–é€šè¿‡ç‰¹å®šç¬¦åˆæ¡ä»¶çš„å“åº”ã€‚ ç”¨äºæ•æ„Ÿè¯è¿‡æ»¤ï¼Œç‰¹æ®Šè¯­æ®µæ— å‘½ä»¤ä¸»åŠ¨å“åº”ï¼ŒåŠ¨æ€é…ç½®å“åº”æ‰³æœºï¼Œæ‹’ç»æŸäº›ç”¨æˆ·å›ç­”ç­‰åœºæ™¯ã€‚</p><div class="language-jupyterpython vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jupyterpython</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@resign_trigger(Trigger(on_platform=&quot;telegram&quot;, action=&quot;deny&quot;, priority=0))</span></span>
<span class="line"><span style="color:#e1e4e8;">async def on_chat_message(message: str, uid: str, **kwargs):</span></span>
<span class="line"><span style="color:#e1e4e8;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">    :param message: RawMessage</span></span>
<span class="line"><span style="color:#e1e4e8;">    :return:</span></span>
<span class="line"><span style="color:#e1e4e8;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">    if &quot;&lt;hello&gt;&quot; in message:</span></span>
<span class="line"><span style="color:#e1e4e8;">        return True</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@resign_trigger(Trigger(on_platform=&quot;telegram&quot;, action=&quot;deny&quot;, priority=0))</span></span>
<span class="line"><span style="color:#24292e;">async def on_chat_message(message: str, uid: str, **kwargs):</span></span>
<span class="line"><span style="color:#24292e;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292e;">    :param message: RawMessage</span></span>
<span class="line"><span style="color:#24292e;">    :return:</span></span>
<span class="line"><span style="color:#24292e;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292e;">    if &quot;&lt;hello&gt;&quot; in message:</span></span>
<span class="line"><span style="color:#24292e;">        return True</span></span></code></pre></div><p>å‡½æ•°è¿”å› <code>True</code> åˆ™è¯´æ˜éœ€è¦å‰ç½®åŠ¨ä½œã€‚</p><h3 id="ğŸ”¨-é”™è¯¯ç¦ç”¨" tabindex="-1">ğŸ”¨ é”™è¯¯ç¦ç”¨ <a class="header-anchor" href="#ğŸ”¨-é”™è¯¯ç¦ç”¨" aria-label="Permalink to &quot;ğŸ”¨ é”™è¯¯ç¦ç”¨&quot;">â€‹</a></h3><p>ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨æ¥ç›‘æµ‹è¡ŒåŠ¨å‡½æ•°çš„é”™è¯¯ã€‚é”™è¯¯æ¬¡æ•°è¢«è®°å½•è¿‡å¤šåï¼Œæ­¤å‡½æ•°æ’ä»¶å°±ä¸è¢«è°ƒç”¨äº†ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">@resign_plugin_executor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">function</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">search)</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">search_in_bilibili</span><span style="color:#E1E4E8;">(arg: </span><span style="color:#79B8FF;">dict</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">pass</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">@resign_plugin_executor</span><span style="color:#24292E;">(</span><span style="color:#E36209;">function</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">search)</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">search_in_bilibili</span><span style="color:#24292E;">(arg: </span><span style="color:#005CC5;">dict</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">**</span><span style="color:#24292E;">kwargs):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span></code></pre></div><p>æ³¨æ„è¿™æ˜¯ä¸€ä¸ªåŒæ­¥è£…é¥°å™¨ï¼Œå¦‚æœæ‚¨çš„å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥è°ƒç”¨ utils.syncã€‚</p><blockquote><p>TODO å°†é”™è¯¯ä½œä¸ºæ—¥å¿—è­¦æˆ’åˆ°è¯¥å»çš„åœ°æ–¹ã€‚</p></blockquote><h3 id="ğŸ©-è·¯ç”±é€šä¿¡" tabindex="-1">ğŸ© è·¯ç”±é€šä¿¡ <a class="header-anchor" href="#ğŸ©-è·¯ç”±é€šä¿¡" aria-label="Permalink to &quot;ğŸ© è·¯ç”±é€šä¿¡&quot;">â€‹</a></h3><p>æˆ‘ä»¬é€šè¿‡å®šä¹‰ä»»åŠ¡æ¶ˆæ¯ä¸­çš„ <code>Meta</code> å’Œ <code>Location</code> å‘å„ä¸ªå¹³å°è·¯ç”±é€šä¿¡ã€‚å…·ä½“ä¾‹å­å¦‚ä¸‹ï¼š</p><p>Location ç»§æ‰¿è¿‡æ¥å³å¯ã€‚å› ä¸ºä½ ä¸çŸ¥é“å…¶ä»–ç”¨æˆ·æ˜¯è°ã€‚</p><h4 id="ğŸ“•-é€šä¿¡æ¨¡å¼" tabindex="-1">ğŸ“• é€šä¿¡æ¨¡å¼ <a class="header-anchor" href="#ğŸ“•-é€šä¿¡æ¨¡å¼" aria-label="Permalink to &quot;ğŸ“• é€šä¿¡æ¨¡å¼&quot;">â€‹</a></h4><p><code>Meta</code> æœ‰å¦‚ä¸‹å†…éƒ¨ç»´æŠ¤çš„æ„é€ å‡½æ•°ï¼š</p><h5 id="ğŸ“reply-notify-é€šçŸ¥å›å¤" tabindex="-1">ğŸ“<code>reply_notify</code> é€šçŸ¥å›å¤ <a class="header-anchor" href="#ğŸ“reply-notify-é€šçŸ¥å›å¤" aria-label="Permalink to &quot;ğŸ“\`reply_notify\` é€šçŸ¥å›å¤&quot;">â€‹</a></h5><p>ä»…ä»…é€šçŸ¥ï¼Œä¸å›å†™è®°å¿†è®°å½•ï¼Œä¹Ÿä¸è§¦å‘ä»»ä½•å¤„ç†ã€‚</p><p>ç”¨äºé”™è¯¯é€šçŸ¥æˆ–å•å‘é€šçŸ¥ã€‚</p><p><em>é€‚ç”¨æ¶ˆæ¯å†…å®¹ä¸¾ä¾‹</em></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">å‘ç”Ÿäº†é”™è¯¯ï¼Œæ‚¨æ²¡æœ‰é…ç½®æ’ä»¶éœ€è¦çš„å¸¸é‡ã€‚</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">å‘ç”Ÿäº†é”™è¯¯ï¼Œæ‚¨æ²¡æœ‰é…ç½®æ’ä»¶éœ€è¦çš„å¸¸é‡ã€‚</span></span></code></pre></div><h5 id="ğŸ“reply-raw-å›å¤ä¸å¯è¯»å†…å®¹" tabindex="-1">ğŸ“<code>reply_raw</code> å›å¤ä¸å¯è¯»å†…å®¹ <a class="header-anchor" href="#ğŸ“reply-raw-å›å¤ä¸å¯è¯»å†…å®¹" aria-label="Permalink to &quot;ğŸ“\`reply_raw\` å›å¤ä¸å¯è¯»å†…å®¹&quot;">â€‹</a></h5><p>æ­¤æ¶ˆæ¯ä¼šè¢«å›å†™è¿›è®°å¿†è®°å½•ï¼Œä½œä¸ºè¢«æŸ¥è¯¢çš„å¯¹è±¡ï¼Œç”±LLMå¤„ç†åä»£ä¸ºç­”å¤ã€‚æ¯”å¦‚æœç´¢ï¼Œæ•°æ®é›†æŸ¥è¯¢ç»“æœã€‚</p><p><em>é€‚ç”¨æ¶ˆæ¯å†…å®¹ä¸¾ä¾‹</em></p><div class="language-json5 vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json5</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;query&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;æŸ¥è¯¢å†…å®¹&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;item&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;æŸ¥è¯¢ç»“æœ1&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;æŸ¥è¯¢ç»“æœ2&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;æŸ¥è¯¢ç»“æœ3&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;query&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;æŸ¥è¯¢å†…å®¹&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;item&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;æŸ¥è¯¢ç»“æœ1&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;æŸ¥è¯¢ç»“æœ2&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;æŸ¥è¯¢ç»“æœ3&quot;</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong><code>reply_raw</code> ä¸èƒ½å›å¤æ–‡ä»¶æ¶ˆæ¯ã€‚</strong></p></div><h5 id="ğŸ“reply-message-å›å¤å¯è¯»å†…å®¹-æ–‡ä»¶æ¶ˆæ¯" tabindex="-1">ğŸ“<code>reply_message</code> å›å¤å¯è¯»å†…å®¹/æ–‡ä»¶æ¶ˆæ¯ <a class="header-anchor" href="#ğŸ“reply-message-å›å¤å¯è¯»å†…å®¹-æ–‡ä»¶æ¶ˆæ¯" aria-label="Permalink to &quot;ğŸ“\`reply_message\` å›å¤å¯è¯»å†…å®¹/æ–‡ä»¶æ¶ˆæ¯&quot;">â€‹</a></h5><p>æ­¤æ¶ˆæ¯é€‚ç”¨äºæ‰§è¡Œå›å¤ã€‚å›å¤äººç±»å¯è¯»çš„å†…å®¹ã€‚å›å†™è®°å¿†è®°å½•ï¼Œç›´æ¥å›å¤ã€‚</p><p><em>é€‚ç”¨æ¶ˆæ¯å†…å®¹ä¸¾ä¾‹</em></p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">æŸ¥è¯¢å®Œæ¯•ï¼Œæ‚¨çš„åŸç¥è´¦å·ä¸ºï¼š123456789</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">æŸ¥è¯¢å®Œæ¯•ï¼Œæ‚¨çš„åŸç¥è´¦å·ä¸ºï¼š123456789</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">æ–‡ä»¶æ¶ˆæ¯</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">æ–‡ä»¶æ¶ˆæ¯</span></span></code></pre></div><h4 id="ğŸ“•-è‡ªå®šä¹‰é€šä¿¡æ¨¡å¼" tabindex="-1">ğŸ“• è‡ªå®šä¹‰é€šä¿¡æ¨¡å¼ <a class="header-anchor" href="#ğŸ“•-è‡ªå®šä¹‰é€šä¿¡æ¨¡å¼" aria-label="Permalink to &quot;ğŸ“• è‡ªå®šä¹‰é€šä¿¡æ¨¡å¼&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark has-focused-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">__plugin_name__ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">task </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">receiver </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">_search_result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> llmkira.some.pack </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Task, TaskHeader, RawMessage</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> task.task_meta.child(__plugin_name__)  </span><span style="color:#6A737D;"># è‡ªå®šä¹‰ </span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.callback_forward </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">True</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.callback_forward_reprocess </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">False</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.direct_reply </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">False</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.write_back </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">True</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.release_chain </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">True</span></span>
<span class="line has-focus"><span style="color:#E1E4E8;">_meta.callback </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> TaskHeader.Meta.Callback(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">role</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;function&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">__plugin_name__</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> Task(</span><span style="color:#FFAB70;">queue</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">receiver.platform).send_task(</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FFAB70;">task</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">TaskHeader(</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FFAB70;">sender</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">task.sender,  </span><span style="color:#6A737D;"># ç»§æ‰¿å‘é€è€…</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FFAB70;">receiver</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">receiver,  </span><span style="color:#6A737D;"># å› ä¸ºå¯èƒ½æœ‰è½¬å‘ï¼Œæ‰€ä»¥å¯ä»¥å•é…</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FFAB70;">task_meta</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">_meta,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FFAB70;">message</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">[</span></span>
<span class="line"><span style="color:#E1E4E8;">                RawMessage(</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FFAB70;">user_id</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">receiver.user_id,</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FFAB70;">chat_id</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">receiver.chat_id,</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FFAB70;">text</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">_search_result</span></span>
<span class="line"><span style="color:#E1E4E8;">                )</span></span>
<span class="line"><span style="color:#E1E4E8;">            ]</span></span>
<span class="line"><span style="color:#E1E4E8;">        )</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span></span></code></pre><pre class="shiki github-light has-focused-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">__plugin_name__ </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">task </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">receiver </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">_search_result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> llmkira.some.pack </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Task, TaskHeader, RawMessage</span></span>
<span class="line"></span>
<span class="line has-focus"><span style="color:#24292E;">_meta </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> task.task_meta.child(__plugin_name__)  </span><span style="color:#6A737D;"># è‡ªå®šä¹‰ </span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.callback_forward </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">True</span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.callback_forward_reprocess </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">False</span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.direct_reply </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">False</span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.write_back </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">True</span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.release_chain </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">True</span></span>
<span class="line has-focus"><span style="color:#24292E;">_meta.callback </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> TaskHeader.Meta.Callback(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">role</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;function&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">__plugin_name__</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> Task(</span><span style="color:#E36209;">queue</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">receiver.platform).send_task(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#E36209;">task</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">TaskHeader(</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#E36209;">sender</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">task.sender,  </span><span style="color:#6A737D;"># ç»§æ‰¿å‘é€è€…</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#E36209;">receiver</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">receiver,  </span><span style="color:#6A737D;"># å› ä¸ºå¯èƒ½æœ‰è½¬å‘ï¼Œæ‰€ä»¥å¯ä»¥å•é…</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#E36209;">task_meta</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">_meta,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#E36209;">message</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">                RawMessage(</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#E36209;">user_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">receiver.user_id,</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#E36209;">chat_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">receiver.chat_id,</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#E36209;">text</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">_search_result</span></span>
<span class="line"><span style="color:#24292E;">                )</span></span>
<span class="line"><span style="color:#24292E;">            ]</span></span>
<span class="line"><span style="color:#24292E;">        )</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>task_meta</code> å‚æ•°å¿…é¡»ç”±å‡½æ•°ä¼ é€’çš„ <code>task_meta</code> çš„ <code>child</code> å‡½æ•°å…‹éš†è¿‡æ¥ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ç¦æ­¢ä¿®æ”¹ <code>continue_step</code> å’Œ <code>limit_child</code> å±æ€§ï¼Œå½±å“é€’å½’æ·±åº¦ã€‚</p></div><h2 id="ğŸƒ-åœ¨æ’ä»¶ä¸­è®¿é—®-åˆ›å»ºæ–‡ä»¶" tabindex="-1">ğŸƒ åœ¨æ’ä»¶ä¸­è®¿é—®/åˆ›å»ºæ–‡ä»¶ <a class="header-anchor" href="#ğŸƒ-åœ¨æ’ä»¶ä¸­è®¿é—®-åˆ›å»ºæ–‡ä»¶" aria-label="Permalink to &quot;ğŸƒ åœ¨æ’ä»¶ä¸­è®¿é—®/åˆ›å»ºæ–‡ä»¶&quot;">â€‹</a></h2><p>Redis ä¸Šä¼ ä¸‹è½½ä¾èµ–ä¸€ä¸ªçŸ­æ–‡ä»¶ IDã€‚</p><p>å‚è€ƒä»¥ä¸‹å¤„ç†</p><h3 id="ğŸ“¥-ä¸‹è½½æ–‡ä»¶" tabindex="-1">ğŸ“¥ ä¸‹è½½æ–‡ä»¶ <a class="header-anchor" href="#ğŸ“¥-ä¸‹è½½æ–‡ä»¶" aria-label="Permalink to &quot;ğŸ“¥ ä¸‹è½½æ–‡ä»¶&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(self, task: TaskHeader, receiver: TaskHeader.Location, arg, </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">    å¤„ç†messageï¼Œè¿”å›message</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    _translate_file </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> item </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> task.message:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> item.file:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> item.file:</span></span>
<span class="line"><span style="color:#E1E4E8;">                _translate_file.append(i)</span></span>
<span class="line"><span style="color:#E1E4E8;">    _file_obj </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> RawMessage.download_file(</span><span style="color:#FFAB70;">file_id</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">i.file_id)</span></span>
<span class="line"><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">sorted</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">set</span><span style="color:#E1E4E8;">(_translate_file), </span><span style="color:#FFAB70;">key</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">_translate_file.index)]</span></span>
<span class="line"><span style="color:#E1E4E8;">    _file_obj: List[File.Data] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [item </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> item </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> _file_obj </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> item]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(self, task: TaskHeader, receiver: TaskHeader.Location, arg, </span><span style="color:#D73A49;">**</span><span style="color:#24292E;">kwargs):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">    å¤„ç†messageï¼Œè¿”å›message</span></span>
<span class="line"><span style="color:#032F62;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    _translate_file </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> item </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> task.message:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> item.file:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> item.file:</span></span>
<span class="line"><span style="color:#24292E;">                _translate_file.append(i)</span></span>
<span class="line"><span style="color:#24292E;">    _file_obj </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> RawMessage.download_file(</span><span style="color:#E36209;">file_id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">i.file_id)</span></span>
<span class="line"><span style="color:#24292E;">                 </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">sorted</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">set</span><span style="color:#24292E;">(_translate_file), </span><span style="color:#E36209;">key</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">_translate_file.index)]</span></span>
<span class="line"><span style="color:#24292E;">    _file_obj: List[File.Data] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [item </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> item </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> _file_obj </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> item]</span></span></code></pre></div><h3 id="ğŸ“¤-ä¸Šä¼ æ–‡ä»¶" tabindex="-1">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶ <a class="header-anchor" href="#ğŸ“¤-ä¸Šä¼ æ–‡ä»¶" aria-label="Permalink to &quot;ğŸ“¤ ä¸Šä¼ æ–‡ä»¶&quot;">â€‹</a></h3><div class="language-jupyterpython vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jupyterpython</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">file_obj = await RawMessage.upload_file(name=&quot;test.png&quot;, data=translated_file.getvalue())</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">file_obj = await RawMessage.upload_file(name=&quot;test.png&quot;, data=translated_file.getvalue())</span></span></code></pre></div><h2 id="ğŸ“©-æ³¨å†Œ-entrypoint-group" tabindex="-1">ğŸ“© æ³¨å†Œ EntryPoint Group <a class="header-anchor" href="#ğŸ“©-æ³¨å†Œ-entrypoint-group" aria-label="Permalink to &quot;ğŸ“© æ³¨å†Œ EntryPoint Group&quot;">â€‹</a></h2><p>æ–‡æ¡£å‚è€ƒ <a href="https://python-poetry.org/docs/pyproject/#plugins" target="_blank" rel="noreferrer">https://python-poetry.org/docs/pyproject/#plugins</a></p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">tool</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">poetry</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">plugins</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">&quot;llmkira</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">extra</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">plugin&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#6A737D;"># The entrypoint name is the name of the plugin.</span></span>
<span class="line"><span style="color:#6A737D;"># å‰é¢å’Œåé¢éƒ½è¦å”¯ä¸€ï¼Œæ³¨å†Œé’©å­çš„æ—¶å€™ä¼šç”¨åˆ°</span></span>
<span class="line"><span style="color:#E1E4E8;">bilisearch = </span><span style="color:#9ECBFF;">&quot;llmbot_plugin_bilisearch&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#6F42C1;">tool</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">poetry</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">plugins</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">&quot;llmkira</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">extra</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">plugin&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#6A737D;"># The entrypoint name is the name of the plugin.</span></span>
<span class="line"><span style="color:#6A737D;"># å‰é¢å’Œåé¢éƒ½è¦å”¯ä¸€ï¼Œæ³¨å†Œé’©å­çš„æ—¶å€™ä¼šç”¨åˆ°</span></span>
<span class="line"><span style="color:#24292E;">bilisearch = </span><span style="color:#032F62;">&quot;llmbot_plugin_bilisearch&quot;</span></span></code></pre></div><p>ç­‰å·çš„åé¢æ˜¯æ’ä»¶çš„åŒ…åï¼Œå‰é¢æ˜¯å”¯ä¸€é”®ï¼ˆè¯·ç¡®ä¿ä¸ä¼šä¸å…¶ä»–æ’ä»¶å†²çªï¼‰</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">tool</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">poetry</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">name = </span><span style="color:#9ECBFF;">&quot;llmbot_plugin_bilisearch&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#6F42C1;">tool</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">poetry</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">name = </span><span style="color:#032F62;">&quot;llmbot_plugin_bilisearch&quot;</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ä½ <strong>å¿…é¡»æ³¨å†Œ</strong> EntryPoint æ‰èƒ½è¢«æœºå™¨äººå¯åŠ¨ç¨‹åºæ£€ç´¢åˆ°ã€‚</p></div><h2 id="ğŸ”¨-å‘å¸ƒåŒ…" tabindex="-1">ğŸ”¨ å‘å¸ƒåŒ… <a class="header-anchor" href="#ğŸ”¨-å‘å¸ƒåŒ…" aria-label="Permalink to &quot;ğŸ”¨ å‘å¸ƒåŒ…&quot;">â€‹</a></h2><p><code>poetry publish</code> å‘å¸ƒåŒ…ï¼Œæˆ–è€…ä½¿ç”¨ CI è‡ªåŠ¨å‘å¸ƒã€‚</p><h3 id="ğŸ”§-ï¸åŒ…ç®¡ç†è¯´æ˜" tabindex="-1">ğŸ”§ ï¸åŒ…ç®¡ç†è¯´æ˜ <a class="header-anchor" href="#ğŸ”§-ï¸åŒ…ç®¡ç†è¯´æ˜" aria-label="Permalink to &quot;ğŸ”§ ï¸åŒ…ç®¡ç†è¯´æ˜&quot;">â€‹</a></h3><p>æ¯æ¬¡å‡çº§æ—¶ï¼Œéƒ½è¦æ›´æ–° <code>version</code> å­—æ®µã€‚</p><h3 id="âš™ï¸-ciè‡ªåŠ¨å‘å¸ƒ" tabindex="-1">âš™ï¸ CIè‡ªåŠ¨å‘å¸ƒ <a class="header-anchor" href="#âš™ï¸-ciè‡ªåŠ¨å‘å¸ƒ" aria-label="Permalink to &quot;âš™ï¸ CIè‡ªåŠ¨å‘å¸ƒ&quot;">â€‹</a></h3><p>åœ¨ <code>.github/workflows/publish.yml</code> æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">publish</span></span>
<span class="line"><span style="color:#79B8FF;">on</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">push</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tags</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">v*</span></span>
<span class="line"><span style="color:#85E89D;">jobs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">runs-on</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">steps</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Publish python package</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">JRubics/poetry-publish@v1.16</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">pypi_token</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ secrets.PYPI_TOKEN }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">publish</span></span>
<span class="line"><span style="color:#005CC5;">on</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">push</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tags</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">v*</span></span>
<span class="line"><span style="color:#22863A;">jobs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">release</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">runs-on</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ubuntu-latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">steps</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Publish python package</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">JRubics/poetry-publish@v1.16</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">pypi_token</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ secrets.PYPI_TOKEN }}</span></span></code></pre></div><p>ä»“åº“ä¸»ç•Œé¢å³ä¸‹è§’æ–°å»º <code>Release</code>, æ–°å»º <code>v</code> å¼€å¤´çš„æ ‡ç­¾ï¼Œåˆ›å»ºåå³å¯è§¦å‘è‡ªåŠ¨å‘å¸ƒã€‚</p>`,126),e=[o];function t(c,r,y,i,E,d){return a(),n("div",null,e)}const h=s(p,[["render",t]]);export{F as __pageData,h as default};
