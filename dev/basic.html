<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸ“ æ’ä»¶å¼€å‘æŒ‡å— | Openai Kira Org</title>
    <meta name="description" content="Kira Kira Openaibot.">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/Docs/assets/style.DwJriB3T.css" as="style">
    
    <script type="module" src="/Docs/assets/app.B7-d7Jnb.js"></script>
    <link rel="preload" href="/Docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/Docs/assets/chunks/framework.D0kgyeKq.js">
    <link rel="modulepreload" href="/Docs/assets/chunks/theme.BrSEN3kJ.js">
    <link rel="modulepreload" href="/Docs/assets/dev_basic.md.681OQhEy.lean.js">
    <meta name="theme-color" content="#3c8772">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/Docs/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://avatars.githubusercontent.com/u/124290462?s=200&amp;v=4" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>LLMKira</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Docs/guide/getting-started" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Deploy Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/Docs/dev/basic" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>Dev Tutorials</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>About Repo</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/LLMKira/Openaibot/pulls?q=" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->Changelog<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-ccf7ddec data-v-88af2de4 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><span class="vpi-languages option-icon" data-v-b6c34ac9></span><!----><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>Chinese</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-43f1e123><a class="VPLink link" href="/Docs/en/dev/basic" data-v-43f1e123><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/LLMKira/Openaibot" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="group translations" data-v-d0bd9dde><p class="trans-title" data-v-d0bd9dde>Chinese</p><!--[--><div class="VPMenuLink" data-v-d0bd9dde data-v-43f1e123><a class="VPLink link" href="/Docs/en/dev/basic" data-v-43f1e123><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/LLMKira/Openaibot" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>æ’ä»¶å¼€å‘æŒ‡å—</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Docs/dev/basic" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>å¿«é€Ÿå¼€å‘</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>å¹³å°å¼€å‘æŒ‡å—</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Docs/dev/arch" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>æ¶æ„ä»‹ç»</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/Docs/dev/client" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>æ”¶å‘ç«¯</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-269c27a6><div class="content" data-v-269c27a6><div class="outline-marker" data-v-269c27a6></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-269c27a6>On this page</div><ul class="VPDocOutlineItem root" data-v-269c27a6 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _Docs_dev_basic" data-v-39a288b8><div><h1 id="ğŸ“-æ’ä»¶å¼€å‘æŒ‡å—" tabindex="-1">ğŸ“ æ’ä»¶å¼€å‘æŒ‡å— <a class="header-anchor" href="#ğŸ“-æ’ä»¶å¼€å‘æŒ‡å—" aria-label="Permalink to &quot;ğŸ“ æ’ä»¶å¼€å‘æŒ‡å—&quot;">â€‹</a></h1><p><img src="https://raw.githubusercontent.com/LlmKira/.github/main/llmbot/func_call_big.png" alt="Func"></p><blockquote><p>æ­¤è¿‡ç¨‹å¯èƒ½ä¼šè¿‡æ—¶ï¼Œæ¨èç›´æ¥ä»æ¨¡æ¿åº“å¼€å§‹å¼€å‘ã€‚ä¹Ÿå¯ä»¥å‚è€ƒå†…éƒ¨æ’ä»¶ <code>llmkira/extra/</code>ã€‚</p></blockquote><p>OpenaiBot ä¸ºç¬¬ä¸‰æ–¹æ’ä»¶æä¾›äº† OPENAPI æ¥å£æ³¨å†Œç³»ç»Ÿå’Œæ¨¡æ¿ä»“åº“ï¼Œæ’ä»¶æ¨¡æ¿: <a href="https://github.com/LlmKira/llmbot_plugin_bilisearch" target="_blank" rel="noreferrer">https://github.com/LlmKira/llmbot_plugin_bilisearch</a> ï¼Œè¯·ä¿®æ”¹æ­¤é¡¹ç›®æ¨¡æ¿è¿›è¡Œå¿«é€Ÿå¼€å‘ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å› ä¸ºæ’ä»¶æœºåˆ¶æ˜¯å‚è€ƒ <code>Nonebot</code> å®ç°ï¼Œæ•…æ’ä»¶å¼€å‘å’Œ NoneBot Plugin è¿‘ä¼¼ã€‚</p></div><p>é€šè¿‡ä¸Šä¼ åˆ° PyPi ä»“åº“ï¼Œæ‚¨å¯ä»¥å°†æ’ä»¶åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·ã€‚</p><h2 id="ğŸ”—-åŸºç¡€çŸ¥è¯†" tabindex="-1">ğŸ”— åŸºç¡€çŸ¥è¯† <a class="header-anchor" href="#ğŸ”—-åŸºç¡€çŸ¥è¯†" aria-label="Permalink to &quot;ğŸ”— åŸºç¡€çŸ¥è¯†&quot;">â€‹</a></h2><p>é¦–å…ˆç¡®è®¤æ‚¨å®‰è£…äº†ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼ŒPython ç¯å¢ƒ(ç‰ˆæœ¬å¤§äº3.9)ã€‚åœ¨ Shellæ§åˆ¶å° æˆ– CMDå‘½ä»¤è¡Œ è¾“å…¥ <code>python -v</code> æ£€æŸ¥æˆ–æŸ¥çœ‹ç‰ˆæœ¬ã€‚</p><h3 id="pdm-ç¯å¢ƒç®¡ç†ä½¿ç”¨" tabindex="-1">PDM ç¯å¢ƒç®¡ç†ä½¿ç”¨ <a class="header-anchor" href="#pdm-ç¯å¢ƒç®¡ç†ä½¿ç”¨" aria-label="Permalink to &quot;PDM ç¯å¢ƒç®¡ç†ä½¿ç”¨&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> llmkira</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pdm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pdm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">packag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pdm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><h2 id="ğŸ“¦-å¼€å‘æµç¨‹" tabindex="-1">ğŸ“¦ å¼€å‘æµç¨‹ <a class="header-anchor" href="#ğŸ“¦-å¼€å‘æµç¨‹" aria-label="Permalink to &quot;ğŸ“¦ å¼€å‘æµç¨‹&quot;">â€‹</a></h2><p>æ’ä»¶å†…éƒ¨ç”± å‡½æ•°ç±»ï¼Œå·¥å…·ç±»ï¼Œå…ƒä¿¡æ¯ï¼ŒåŠŸèƒ½å‡½æ•°ï¼Œå‚æ•°æ ¡éªŒç±» ç»„æˆã€‚</p><p>å‡½æ•°å†…æ’ä»¶åç§°<strong>å¿…é¡»</strong>ç”± <code>__plugin_name__</code> å‚æ•°å¼•ç”¨ã€‚</p><h3 id="ğŸ”§-æµ‹è¯•ç¯å¢ƒ" tabindex="-1">ğŸ”§ æµ‹è¯•ç¯å¢ƒ <a class="header-anchor" href="#ğŸ”§-æµ‹è¯•ç¯å¢ƒ" aria-label="Permalink to &quot;ğŸ”§ æµ‹è¯•ç¯å¢ƒ&quot;">â€‹</a></h3><p>æ‚¨å¯ä»¥å°†æ’ä»¶æ–‡ä»¶å¤¹æ”¾å…¥ <code>Openaibot/llmkira/extra/plugins</code> ä¸‹ï¼Œç¨‹åºä¼šè‡ªåŠ¨åŠ è½½ã€‚</p><h3 id="ğŸ¬-å®‰è£…-llmkira-æ¡†æ¶" tabindex="-1">ğŸ¬ å®‰è£… llmkira æ¡†æ¶ <a class="header-anchor" href="#ğŸ¬-å®‰è£…-llmkira-æ¡†æ¶" aria-label="Permalink to &quot;ğŸ¬ å®‰è£… llmkira æ¡†æ¶&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pdm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> llmkira</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dev</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿™æ ·è£…ä¸å½±å“æœºå™¨äºº</span></span></code></pre></div><h3 id="ğŸª£-äº†è§£æ¶æ„éªŒè¯" tabindex="-1">ğŸª£ äº†è§£æ¶æ„éªŒè¯ <a class="header-anchor" href="#ğŸª£-äº†è§£æ¶æ„éªŒè¯" aria-label="Permalink to &quot;ğŸª£ äº†è§£æ¶æ„éªŒè¯&quot;">â€‹</a></h3><p>å½“æ’ä»¶ç³»ç»Ÿæœ‰å¤§å˜åŠ¨æ—¶ï¼Œæ‚¨éœ€è¦æ›´æ–°æ’ä»¶æ¶æ„ç‰ˆæœ¬ã€‚</p><p>ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æ’ä»¶å¯åŠ¨æ—¶çš„æ¶æ„éªŒè¯ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark has-highlighted vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;search_in_bilibili&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__openapi_version__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;20240416&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.sdk.tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verify_openapi_version  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># noqa: E402</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verify_openapi_version(__plugin_name__, __openapi_version__)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># éªŒè¯</span></span></code></pre></div><p><code>openapi_version</code> å‚æ•°è®°å½•å½“å‰åŒæ­¥ç‰ˆæœ¬ï¼Œå¦‚æœå®¿ä¸»æ¡†æ¶æ›´æ–°ï¼ŒPlugin å¯èƒ½éœ€è¦åŒæ­¥æ­¤å‚æ•°ä»¥æ”¯æŒæ–°æ¥å£ã€‚</p><div class="tip custom-block"><p class="custom-block-title">ä»€ä¹ˆæ—¶å€™éœ€è¦æ›´æ–°æˆ‘çš„æ’ä»¶ï¼Ÿ</p><p>OpenAPI ç»„ä»¶ä¼šè®¾å®šå“ªäº›ç‰ˆæœ¬çš„æ’ä»¶å¯ä»¥è¢«åŠ è½½ï¼Œå¦‚æœæ‚¨çš„æ’ä»¶ç‰ˆæœ¬è¿‡ä½ï¼Œä¼šæŠ¥é”™ï¼Œå±Šæ—¶æ‚¨å°†æ”¶åˆ°ç”¨æˆ·çš„ Issueã€‚</p></div><h3 id="âš™ï¸-äº†è§£å¦‚ä½•å£°æ˜ä¸€ä¸ªå·¥å…·" tabindex="-1">âš™ï¸ äº†è§£å¦‚ä½•å£°æ˜ä¸€ä¸ªå·¥å…· <a class="header-anchor" href="#âš™ï¸-äº†è§£å¦‚ä½•å£°æ˜ä¸€ä¸ªå·¥å…·" aria-label="Permalink to &quot;âš™ï¸ äº†è§£å¦‚ä½•å£°æ˜ä¸€ä¸ªå·¥å…·&quot;">â€‹</a></h3><p>å¾ˆç®€å•ã€‚æˆ‘ä»¬ä» pydantic ç›´æ¥ç»§æ‰¿ <code>BaseModel</code> ç±»ï¼Œç„¶ååœ¨ç±»ä¸­å®šä¹‰å‚æ•°ã€‚åº•å±‚ä»£ç ä¼šç›´æ¥ä»ç±»ä¸­æ„å»ºå·¥å…·çš„ Schemaã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.sdk.schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Function</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel, ConfigDict, field_validator, Field</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Optional</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TOOL_NAME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    TOOL DESCRIPTION</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    delay: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Arguments description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Arguments description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    option_content: Optional[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Arguments description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @field_validator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delay&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> delay_validator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cls, v):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delay must be greater than 0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v</span></span></code></pre></div><h4 id="ğŸ©¼-å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªç±»" tabindex="-1">ğŸ©¼ å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªç±»ï¼Ÿ <a class="header-anchor" href="#ğŸ©¼-å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªç±»" aria-label="Permalink to &quot;ğŸ©¼ å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªç±»ï¼Ÿ&quot;">â€‹</a></h4><p>ç¨‹åºä¼šæŠŠLLMç”Ÿäº§çš„å‡½æ•°å‚æ•°ä¼ é€’ç»™è¿™ä¸ªç±»ï¼Œç„¶åè¿›è¡Œå®ä¾‹åŒ–ã€‚</p><p>å€ŸåŠ©äº <a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noreferrer">pydantic</a> ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å‡†ç¡®æ–¹ä¾¿çš„å‚æ•°æ ¡éªŒã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark has-focused-lines vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel, ConfigDict</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Bili</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‚æ•°</span></span>
<span class="line has-focus"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    keywords: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line has-focus"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConfigDict(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">extra</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;allow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line has-focus"><wbr></span>
<span class="line has-focus"><wbr></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line has-focus"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _set </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bili.model_validate({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;arg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line has-focus"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # failed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span></span></code></pre></div><h3 id="âš“ï¸-åŠŸèƒ½å‡½æ•°" tabindex="-1">âš“ï¸ åŠŸèƒ½å‡½æ•° <a class="header-anchor" href="#âš“ï¸-åŠŸèƒ½å‡½æ•°" aria-label="Permalink to &quot;âš“ï¸ åŠŸèƒ½å‡½æ•°&quot;">â€‹</a></h3><p>åŠŸèƒ½å‡½æ•°ä¸æ˜¯å¿…è¦çš„ï¼Œæˆ‘ä»¬åªæ˜¯éœ€è¦åœ¨ æ’ä»¶çš„runæ–¹æ³• ä¸­å¤„ç†ä¼ é€’è¿›æ¥çš„å‚æ•°ã€‚</p><h4 id="ğŸ”¨-é”™è¯¯ç¦ç”¨" tabindex="-1">ğŸ”¨ é”™è¯¯ç¦ç”¨ <a class="header-anchor" href="#ğŸ”¨-é”™è¯¯ç¦ç”¨" aria-label="Permalink to &quot;ğŸ”¨ é”™è¯¯ç¦ç”¨&quot;">â€‹</a></h4><p>ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨æ¥ç›‘æµ‹å‡½æ•°çš„é”™è¯¯ã€‚é”™è¯¯æ¬¡æ•°è¢«è®°å½•è¿‡å¤šåï¼Œæ­¤å‡½æ•°æ’ä»¶å°±ä¸è¢«è°ƒç”¨äº†ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.sdk.openapi.fuse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resign_plugin_executor</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@resign_plugin_executor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">search, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handle_exceptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search_in_bilibili</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span></span></code></pre></div><h3 id="ğŸ­-æ’ä»¶ä¸»ä½“" tabindex="-1">ğŸ­ æ’ä»¶ä¸»ä½“ <a class="header-anchor" href="#ğŸ­-æ’ä»¶ä¸»ä½“" aria-label="Permalink to &quot;ğŸ­ æ’ä»¶ä¸»ä½“&quot;">â€‹</a></h3><p>ä½ éœ€è¦ç»§æ‰¿ <code>BaseTool</code> ç±»æ¥å®ç°ä¸»ä½“ï¼Œåœ¨æ’ä»¶è¿è¡Œç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <code>run</code> æ–¹æ³•ã€‚å¦‚æœå¤±è´¥äº†ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <code>failed</code> æ–¹æ³•ã€‚</p><p>run æ–¹æ³•ä½ éœ€è¦åšçš„æ˜¯å¤„ç†ä¼ é€’è¿›æ¥çš„å‚æ•°ï¼Œç„¶åå‘æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        task: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TaskHeader&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        receiver: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Location&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        arg: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        env: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pending_task: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ToolCall&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        refer_llm_result: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    å¤„ç†messageï¼Œè¿”å›message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _set </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BiliBiliSearch.model_validate(arg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _search_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> search_on_bilibili(_set.keywords)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _meta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> task.task_sign.reprocess(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        plugin_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        tool_response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ToolResponse(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                function_response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SearchData: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_search_result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,Please give reference link when use it.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pending_task.id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pending_task,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.create_and_send(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        queue_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver.platform,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TaskHeader(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            sender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">task.sender,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»§æ‰¿å‘é€è€…</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            receiver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å› ä¸ºå¯èƒ½æœ‰è½¬å‘ï¼Œæ‰€ä»¥å¯ä»¥å•é…</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            task_sign</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_meta,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>ç»§æ‰¿ <code>BaseTool</code> ç±»åï¼Œ<strong>ç¦æ­¢å®šä¹‰ <code>__init__</code></strong></p></div><h3 id="ğŸ³-åŠ¨æ€æ¿€æ´»" tabindex="-1">ğŸ³ åŠ¨æ€æ¿€æ´» <a class="header-anchor" href="#ğŸ³-åŠ¨æ€æ¿€æ´»" aria-label="Permalink to &quot;ğŸ³ åŠ¨æ€æ¿€æ´»&quot;">â€‹</a></h3><p>ä¸ºäº†èƒ½æå‡æ’ä»¶çš„å®¹çº³é‡ï¼Œæˆ‘ä»¬æä¾›äº†åŠ¨æ€æ¿€æ´»æ’ä»¶çš„åŠŸèƒ½ã€‚æ ¹æ®å†…å®¹å’Œç”¨æˆ·å†³å®šæ­¤æ’ä»¶æ˜¯å¦æ¿€æ´»ã€‚ æ¯æ¬¡å¯¹è¯é€è¾¾åï¼Œä¼šé‡æ–°æ ¹æ®ç”¨æˆ·è¯­æ–™æ„å»ºæ–°çš„å‡½æ•°è¡¨ï¼Œæ’ä»¶é€‰æ‹©å™¨ä¼šæ ¹æ®å­—ç¬¦åŒ¹é…ç¡®å®šå“ªäº›æ˜¯å€™é€‰å‡½æ•°ã€‚</p><p><code>func_message</code> å‡½æ•°å†³å®šäº†æ˜¯å¦æ¿€æ´»æ­¤å‡½æ•°ï¼Œå¦‚æœæ¿€æ´»åˆ™è¿”å›å‡½æ•°ï¼Œå¦åˆ™è¿”å› <code>None</code>ã€‚ å¦‚æœä½ ä¸é‡å†™æ­¤å‡½æ•°ï¼Œæ’ä»¶ä¼šé»˜è®¤ä½¿ç”¨ <code>keywords</code> å’Œ <code>pattern</code> ç±»å±æ€§è¿›è¡ŒåŒ¹é…ã€‚ ä½ å¯ä»¥è‡ªç”±é‡å†™æ­¤å‡½æ•°ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@abstractmethod</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> func_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, message_text, message_raw, address, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    If the message_text contains the keyword, return the function to be executed, otherwise return None</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :param message_text: æ¶ˆæ¯æ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :param message_raw: æ¶ˆæ¯åŸå§‹æ•°æ® `EventMessage`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :param address: æ¶ˆæ¯åœ°å€ `tuple(sender,receiver)`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :param kwargs :</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    message_raw: æ¶ˆæ¯åŸå§‹æ•°æ® `EventMessage`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    address: æ¶ˆæ¯åœ°å€ `tuple(sender,receiver)`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> word </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.keywords:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> word </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message_text:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.function</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Regrex Match</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pattern:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        match </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.pattern.match(message_text)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> match:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.function</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _ignore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>æ–°å¯¹è¯é“¾è¢«å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç»§æ‰¿ä¸Šä¸€ä¸ªå¯¹è¯é“¾çš„å‡½æ•°å±æ€§ã€‚</p></div><h4 id="ğŸ³-æ–‡ä»¶æ¿€æ´»" tabindex="-1">ğŸ³ æ–‡ä»¶æ¿€æ´» <a class="header-anchor" href="#ğŸ³-æ–‡ä»¶æ¿€æ´»" aria-label="Permalink to &quot;ğŸ³ æ–‡ä»¶æ¿€æ´»&quot;">â€‹</a></h4><p>å½“æ¶ˆæ¯åŒ…å«æ–‡ä»¶æ—¶ï¼Œæ’ä»¶ä¼šæŒ‰ç…§æ–‡ä»¶åæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œæ’ä»¶ä¼šè¢«æ¿€æ´»ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    file_match_required: Optional[re.Pattern] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;re.compile æ–‡ä»¶åæ­£åˆ™&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;File name regular expression to use the tool, exp: re.compile(r&quot;file_id=([a-z0-9]{8})&quot;)&quot;&quot;&quot;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å¦‚æœä½ éœ€è¦ä½¿ç”¨æ–‡ä»¶ï¼Œè¯·å®šä¹‰åœ¨å·¥å…·å‚æ•°å®šä¹‰ <code>file_key</code> å­—æ®µï¼Œ<strong>æ–‡ä»¶ç”± LLM ä¼ é€’ç»™ä½ </strong>ã€‚ä½ é€šè¿‡æ–‡ä»¶ ID è·å–æ–‡ä»¶ã€‚</p></div><h3 id="ğŸ§ƒ-è™šæ‹Ÿç¯å¢ƒå˜é‡" tabindex="-1">ğŸ§ƒ è™šæ‹Ÿç¯å¢ƒå˜é‡ <a class="header-anchor" href="#ğŸ§ƒ-è™šæ‹Ÿç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;ğŸ§ƒ è™šæ‹Ÿç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><ul><li>å£°æ˜æ˜¯å¦éœ€è¦ç¯å¢ƒå˜é‡</li></ul><p>é‡å†™ <code>require_auth</code> å‡½æ•°ï¼Œè¿”å› <code>True</code> æˆ– <code>False</code>ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require_auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, env_map: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Check if authentication is required</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span></code></pre></div><ul><li>å£°æ˜ç¯å¢ƒå˜é‡å‰ç¼€å’Œå¿…è¦å˜é‡</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseTool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    env_required: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field([], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç¯å¢ƒå˜é‡è¦æ±‚,ALSO NEED env_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Pre-required environment variables, you should provide env_prefix&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    env_prefix: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ç¯å¢ƒå˜é‡å‰ç¼€&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Environment variable prefix&quot;&quot;&quot;</span></span></code></pre></div><ul><li>é…ç½®æ–‡æ¡£</li></ul><p>é‡å†™ <code>env_help_docs</code> å‡½æ•°ï¼Œè¿”å›å¸®åŠ©æ–‡æ¡£ã€‚æ­¤æ–‡æ¡£ä¼šåœ¨ç¼ºå¤±å˜é‡æ—¶è¢«å‘é€ç»™ç”¨æˆ·ï¼Œé™„åŠ åœ¨æƒé™ç”³è¯·æ¿å—ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">classmethod</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> env_help_docs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cls, empty_env: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Provide help message for environment variables</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :param empty_env: The environment variable list that not configured</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    :return: The help message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message</span></span></code></pre></div><ul><li>è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡</li></ul><p>è°ƒç”¨ <code>get_os_env</code> å‡½æ•°ï¼Œè·å–ç‰¹å®šå‰ç¼€ <code>PLUGIN_</code> çš„ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ è¿™ä¸ªå˜é‡åº”è¯¥ç”±éƒ¨ç½²è€…çº¦å®šã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@final</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_os_env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, env_name):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Get environment variables from os.environ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    env </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.getenv(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PLUGIN_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env_name, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> env</span></span></code></pre></div><h3 id="ğŸ¥„-æ³¨å†Œå…ƒä¿¡æ¯" tabindex="-1">ğŸ¥„ æ³¨å†Œå…ƒä¿¡æ¯ <a class="header-anchor" href="#ğŸ¥„-æ³¨å†Œå…ƒä¿¡æ¯" aria-label="Permalink to &quot;ğŸ¥„ æ³¨å†Œå…ƒä¿¡æ¯&quot;">â€‹</a></h3><p>å®ä¾‹åŒ–æ ¸å¿ƒç±»<code>PluginMetadata</code> æ¥å£°æ˜æ‰€æœ‰çš„å·¥å…·ï¼Œæ‚¨å¯ä»¥åœ¨ <a href="https://github.com/LlmKira/Openaibot/blob/main/llmkira/sdk/func_calling/schema.py#L84" target="_blank" rel="noreferrer">è¿™é‡Œ</a> æŸ¥çœ‹å®ƒçš„ç»„æˆç»“æ„ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;search_in_bilibili&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__openapi_version__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PluginMetadata, FuncPair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ...</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # import</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸­é—´æ˜¯å‡½æ•°ä»£ç ......</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ¸å¿ƒå…ƒä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_meta__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PluginMetadata(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Search videos on bilibili.com(å“”å“©å“”å“©)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    usage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bilibili search &lt;keywords&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    openapi_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__openapi_version__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FuncPair(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class_tool(BiliBiliSearch), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BiliBiliSearch)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>FuncPair</code> ç»‘å®š <code>function</code> å‡½æ•°ç±»å’Œ <code>tool</code> å·¥å…·ç±»ã€‚</p><p><code>class_tool</code> å‡½æ•°ç”¨äºå°†å‡½æ•°ç±»è½¬æ¢ä¸ºå·¥å…·ç±»ã€‚</p></div><h3 id="ğŸŸ-hook-é’©å­" tabindex="-1">ğŸŸ Hook é’©å­ <a class="header-anchor" href="#ğŸŸ-hook-é’©å­" aria-label="Permalink to &quot;ğŸŸ Hook é’©å­&quot;">â€‹</a></h3><p>Hook æ˜¯ä¸€ä¸ªç”¨äºæ‹¦æˆªæ¶ˆæ¯çš„ç±»ï¼Œå¯ä»¥åœ¨å‘é€å™¨å’Œæ¥æ”¶å™¨ä¹‹é—´è¿›è¡Œæ¶ˆæ¯è½¬æ¢å¤„ç†ã€‚</p><p><code>trigger_hook</code> å‡½æ•°ç”¨äºè§¦å‘é’©å­ï¼Œ<code>hook_run</code> å‡½æ•°ç”¨äºå¤„ç†æ¶ˆæ¯ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ª <code>VoiceHook</code> é’©å­çš„å®ä¾‹ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@resign_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> VoiceHook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    trigger: Trigger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Trigger.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RECEIVER</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trigger_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        platform_name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># noqa</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        messages: List[EventMessage] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        locate: Location </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;locate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> check_string(message.text):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        have_env </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EnvManager(locate.uid).get_env(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;VOICE_REPLY_ME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # logger.warning(f&quot;Voice Hook {have_env}&quot;)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> have_env </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hook_run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        logger.debug(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Voice Hook </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        platform_name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;platform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># noqa</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        messages: List[EventMessage] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        locate: Location </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kwargs.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;locate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> check_string(message.text):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args, kwargs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            parsed_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parse_sentence(message.text)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parsed_text:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args, kwargs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            reecho_api_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EnvManager(locate.uid).get_env(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;REECHO_API_KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            voice_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request_cn(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                message.text, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reecho_api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reecho_api_key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> voice_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ogg_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Ffmpeg.convert(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    input_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mp3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">output_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ogg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stream_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">voice_data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">quiet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> File.upload_file(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    creator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">locate.uid, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;speech.ogg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ogg_data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.caption </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message.text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                message.text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                message.files.append(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                logger.error(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Voice Generation Failed:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">message.text</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args, kwargs</span></span></code></pre></div><p><code>hook_run</code> å‡½æ•°æ˜¯è½®æ¢å¤„ç†æ¶ˆæ¯çš„ï¼Œå‡ºé”™ä¼šè‡ªåŠ¨è·³è¿‡ã€‚å‚æ•°ä¼ å…¥åï¼Œè¿”å›å‚æ•°ä¼šè¢«ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé’©å­ã€‚</p><p>ä¾æ®é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¾“å‡ºæ¶ˆæ¯è½¬æ¢ä¸ºè¯­éŸ³ï¼Œæˆ–è€…æ£€æŸ¥è¾“å…¥æ–‡æœ¬åæ·»åŠ ä¸€äº›é™„ä»¶ã€‚</p><h3 id="ğŸ¥¥-å‰éªŒè§¦å‘å™¨" tabindex="-1">ğŸ¥¥ å‰éªŒè§¦å‘å™¨ <a class="header-anchor" href="#ğŸ¥¥-å‰éªŒè§¦å‘å™¨" aria-label="Permalink to &quot;ğŸ¥¥ å‰éªŒè§¦å‘å™¨&quot;">â€‹</a></h3><p>ä½¿ç”¨è¿™ä¸ªè£…é¥°å™¨æ¥é˜»æ­¢æˆ–é€šè¿‡ç‰¹å®šç¬¦åˆæ¡ä»¶çš„å“åº”ã€‚ ç”¨äºæ•æ„Ÿè¯è¿‡æ»¤ï¼Œç‰¹æ®Šè¯­æ®µæ— å‘½ä»¤ä¸»åŠ¨å“åº”ï¼ŒåŠ¨æ€é…ç½®å“åº”æ‰³æœºï¼Œæ‹’ç»æŸäº›ç”¨æˆ·å›ç­”ç­‰åœºæ™¯ã€‚</p><p>ä¸‹é¢æ˜¯ <code>æ‹’ç»Telegramå¹³å°çš„æ¶ˆæ¯</code> çš„æ‰³æœºå®ä¾‹ã€‚å½“è¿”å› <code>True</code> æ—¶ï¼Œå°†ä¼šæ‰§è¡Œ <code>action</code> å‚æ•°çš„åŠ¨ä½œã€‚</p><div class="language-jupyterpython vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jupyterpython</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>@resign_trigger(Trigger(on_platform=&quot;telegram&quot;, action=&quot;deny&quot;, priority=0))</span></span>
<span class="line"><span>async def on_chat_message(message: str, uid: str, **kwargs):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    :param message: RawMessage</span></span>
<span class="line"><span>    :return:</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    if &quot;&lt;hello&gt;&quot; in message:</span></span>
<span class="line"><span>        return True</span></span></code></pre></div><p>å‡½æ•°è¿”å› <code>True</code> åˆ™è¯´æ˜éœ€è¦å‰ç½®åŠ¨ä½œã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>Trigger</code> æ˜¯ä¸€ä¸ªpydanticç±»ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…æºç æŸ¥çœ‹åŠ¨ä½œã€‚</p></div><h3 id="ğŸ©-è·¯ç”±é€šä¿¡" tabindex="-1">ğŸ© è·¯ç”±é€šä¿¡ <a class="header-anchor" href="#ğŸ©-è·¯ç”±é€šä¿¡" aria-label="Permalink to &quot;ğŸ© è·¯ç”±é€šä¿¡&quot;">â€‹</a></h3><p>æˆ‘ä»¬é€šè¿‡å®šä¹‰ä»»åŠ¡æ¶ˆæ¯ä¸­çš„ <code>Meta</code> å’Œ <code>Location</code> å‘å„ä¸ªå¹³å°è·¯ç”±é€šä¿¡ã€‚å…·ä½“ä¾‹å­å¦‚ä¸‹ï¼š</p><p>Location ç»§æ‰¿è¿‡æ¥å³å¯ã€‚å› ä¸ºä½ ä¸çŸ¥é“å…¶ä»–ç”¨æˆ·æ˜¯è°ã€‚</p><h3 id="ğŸ¬-é€šä¿¡æ¨¡å¼" tabindex="-1">ğŸ¬ é€šä¿¡æ¨¡å¼ <a class="header-anchor" href="#ğŸ¬-é€šä¿¡æ¨¡å¼" aria-label="Permalink to &quot;ğŸ¬ é€šä¿¡æ¨¡å¼&quot;">â€‹</a></h3><p>ä½ å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚</p><p><a href="https://github.com/LlmKira/Openaibot/blob/main/llmkira/task/schema.py" target="_blank" rel="noreferrer">æºç åœ°å€</a></p><p>ä¼ å…¥çš„èŠ‚ç‚¹å¸¦æœ‰åœ°å€å‚æ•°ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.task </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task, TaskHeader  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># noqa: E402</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.task.schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Location, ToolResponse, EventMessage  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># noqa: E402</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.create_and_send(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        queue_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver.platform,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TaskHeader(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            sender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">task.sender,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            receiver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            task_sign</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">meta,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                EventMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    user_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver.user_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    chat_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver.chat_id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ğŸ–</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Run Failedï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exception</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,report it to user.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><p>ç»†èŠ‚å¯ä»¥æŸ¥çœ‹æºç ã€‚</p><h4 id="ğŸ¬-æ¶ˆæ¯ä¼ é€’" tabindex="-1">ğŸ¬ æ¶ˆæ¯ä¼ é€’ <a class="header-anchor" href="#ğŸ¬-æ¶ˆæ¯ä¼ é€’" aria-label="Permalink to &quot;ğŸ¬ æ¶ˆæ¯ä¼ é€’&quot;">â€‹</a></h4><p><code>message</code> å‚æ•°æ¥å—çš„æ˜¯ä¸€ä¸ª <code>EventMessage</code> ç±»çš„åˆ—è¡¨ï¼Œä½ å¯ä»¥ç›´æ¥ä¼ é€’æ¶ˆæ¯ç»™ç”¨æˆ·ã€‚</p><h4 id="ğŸ“•-ä»»åŠ¡æ ‡è®°" tabindex="-1">ğŸ“• ä»»åŠ¡æ ‡è®° <a class="header-anchor" href="#ğŸ“•-ä»»åŠ¡æ ‡è®°" aria-label="Permalink to &quot;ğŸ“• ä»»åŠ¡æ ‡è®°&quot;">â€‹</a></h4><p><code>task_sign</code> å‚æ•°æ¥å—çš„å³æ˜¯ å¹³å°å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œå’Œå·¥å…·ç›¸å…³çš„ä¿¡æ¯ã€‚ä½ éœ€è¦æ´¾ç”Ÿä¸€ä¸ªæ–°çš„ <code>task_sign</code>ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">meta </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> task.task_sign.reply(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    plugin_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    tool_response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ToolResponse(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__plugin_name__,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            function_response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Run Failed </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exception</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pending_task.id,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            tool_call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pending_task,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>å¯ä»¥æ´¾ç”Ÿçš„ç±»æ–¹æ³•æœ‰ï¼š</p><ul><li><code>reply</code> å›å¤æ¶ˆæ¯ï¼Œç›´æ¥å›å¤æ¶ˆæ¯ï¼Œå¹¶ä¸”å†™å…¥è®°å¿†è®°å½•ï¼Œå¦‚ï¼š<code>æŸ¥è¯¢å®Œæ¯•ï¼Œæ‚¨çš„åŸç¥è´¦å·ä¸ºï¼š123456789</code></li><li><code>reprocess</code> é‡æ–°å¤„ç†ï¼Œå°†éäººç±»å¯è¯»çš„æ•°æ®ç»è¿‡LLMå†æ¬¡å¤„ç†åå›å¤ï¼Œå¦‚ï¼š<code>{json_data}</code></li><li><code>notify</code> é€šçŸ¥ï¼Œåªé€šçŸ¥ï¼Œä¸è§¦å‘ä»»ä½•å…¶ä»–å¤„ç†ï¼Œå¦‚ï¼š<code>å‘ç”Ÿé”™è¯¯ï¼Œæ‚¨æ²¡æœ‰é…ç½®æ’ä»¶éœ€è¦çš„å¸¸é‡ã€‚</code></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>è¿™é‡Œçš„æ´¾ç”ŸæŒ‡è·¯ç”±æ–¹å¼ï¼Œæ˜¯æŒ‡ç¤ºæ¶ˆæ¯å’Œå·¥å…·å“åº”å¦‚ä½•è¢«å¤„ç†ã€‚ä¸æ˜¯æŒ‡åŠŸèƒ½ã€‚</p></div><h2 id="ğŸƒ-åœ¨æ’ä»¶ä¸­è®¿é—®-åˆ›å»ºæ–‡ä»¶" tabindex="-1">ğŸƒ åœ¨æ’ä»¶ä¸­è®¿é—®/åˆ›å»ºæ–‡ä»¶ <a class="header-anchor" href="#ğŸƒ-åœ¨æ’ä»¶ä¸­è®¿é—®-åˆ›å»ºæ–‡ä»¶" aria-label="Permalink to &quot;ğŸƒ åœ¨æ’ä»¶ä¸­è®¿é—®/åˆ›å»ºæ–‡ä»¶&quot;">â€‹</a></h2><p>æ–‡ä»¶äº¤æµé  LLM çš„ä¸Šä¸‹æ–‡å’Œæ’ä»¶çš„ <code>file_key</code> å­—æ®µã€‚ï¼ˆæ˜¯çš„ï¼Œæ–‡ä»¶éœ€è¦é€šè¿‡LLMçš„å“åº”æ‰èƒ½è¢«ä¼ é€’ï¼‰</p><p>åˆ›å»ºä¸€ä¸ªå­—æ®µæ¥å—æ–‡ä»¶ IDï¼Œç„¶åé€šè¿‡ <code>File</code> ç±»çš„æ–¹æ³•è·å–æ–‡ä»¶ã€‚</p><h3 id="ğŸ“¥-ä¸‹è½½æ–‡ä»¶" tabindex="-1">ğŸ“¥ ä¸‹è½½æ–‡ä»¶ <a class="header-anchor" href="#ğŸ“¥-ä¸‹è½½æ–‡ä»¶" aria-label="Permalink to &quot;ğŸ“¥ ä¸‹è½½æ–‡ä»¶&quot;">â€‹</a></h3><p>ä»å…¨å±€æ–‡ä»¶KVç®¡ç†å™¨ä¸‹è½½æ–‡ä»¶ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, task: TaskHeader, receiver: TaskHeader.Location, arg, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    å¤„ç†messageï¼Œè¿”å›message</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GLOBAL_FILE_HANDLER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.download_file(file_key)</span></span></code></pre></div><h3 id="ğŸ“¤-ä¸Šä¼ æ–‡ä»¶" tabindex="-1">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶ <a class="header-anchor" href="#ğŸ“¤-ä¸Šä¼ æ–‡ä»¶" aria-label="Permalink to &quot;ğŸ“¤ ä¸Šä¼ æ–‡ä»¶&quot;">â€‹</a></h3><p>ç”¨ä¾¿æ·æ„é€ æ–¹æ³•ä¸Šä¼ æ–‡ä»¶ã€‚ï¼ˆå®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†å…¨å±€æ–‡ä»¶KVç®¡ç†å™¨ï¼‰</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llmkira.kv_manager.file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> File</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _files </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> File.upload_file(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        creator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiver.uid,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        file_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        file_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><h2 id="ğŸ“©-æ³¨å†Œ-entrypoint-group" tabindex="-1">ğŸ“© æ³¨å†Œ EntryPoint Group <a class="header-anchor" href="#ğŸ“©-æ³¨å†Œ-entrypoint-group" aria-label="Permalink to &quot;ğŸ“© æ³¨å†Œ EntryPoint Group&quot;">â€‹</a></h2><p>æ–‡æ¡£å‚è€ƒ <a href="https://pdm-project.org/latest/reference/pep621/#entry-points" target="_blank" rel="noreferrer">https://pdm-project.org/latest/reference/pep621/#entry-points</a></p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entry-points</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;llmkira</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">extra</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># const value as &quot;llmkira.extra.plugin&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bilisearch = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;llmbot_plugin_bilisearch&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;your plugin id&gt;=&lt;your plugin name&gt;</span></span></code></pre></div><p>ç­‰å·çš„åé¢æ˜¯æ’ä»¶çš„åŒ…åï¼Œå‰é¢æ˜¯å”¯ä¸€é”®ï¼ˆè¯·ç¡®ä¿ä¸ä¼šä¸å…¶ä»–æ’ä»¶å†²çªï¼‰</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ä½ <strong>å¿…é¡»æ³¨å†Œ</strong> EntryPoint æ‰èƒ½è¢«æœºå™¨äººå¯åŠ¨ç¨‹åºæ£€ç´¢åˆ°ã€‚</p></div><h2 id="ğŸ”¨-å‘å¸ƒåˆ°-pypi" tabindex="-1">ğŸ”¨ å‘å¸ƒåˆ° PyPi <a class="header-anchor" href="#ğŸ”¨-å‘å¸ƒåˆ°-pypi" aria-label="Permalink to &quot;ğŸ”¨ å‘å¸ƒåˆ° PyPi&quot;">â€‹</a></h2><p>ç™»é™† PyPi ä»“åº“ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åŒ…ï¼Œç„¶åä½¿ç”¨æ¨¡æ¿ä»“åº“çš„ CI/CD è‡ªåŠ¨å‘å¸ƒã€‚</p><p><img src="https://github.com/LlmKira/Docs/blob/main/docs/_assert/pypi.png?raw=true" alt="pypi"></p><p>å½“ä½ è¿™æ ·é…ç½®æ—¶ï¼ŒCI å¯ä»¥æ— å¯†é’¥è‡ªåŠ¨å‘å¸ƒåŒ…ã€‚</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">publish</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  workflow_dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pypi-*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">permissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  contents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">read</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  pypi-publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">upload release to PyPI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    permissions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # IMPORTANT: this permission is mandatory for trusted publishing</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      id-token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">write</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pdm-project/setup-pdm@v3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Publish package distributions to PyPI</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pdm publish</span></span></code></pre></div><h3 id="ğŸ”§-å‘å¸ƒ" tabindex="-1">ğŸ”§ å‘å¸ƒ <a class="header-anchor" href="#ğŸ”§-å‘å¸ƒ" aria-label="Permalink to &quot;ğŸ”§ å‘å¸ƒ&quot;">â€‹</a></h3><p>ä»“åº“ä¸»ç•Œé¢å³ä¸‹è§’æ–°å»º <code>Release</code>, æ–°å»º <code>pypi-</code> å¼€å¤´çš„æ ‡ç­¾ï¼Œåˆ›å»ºåå³å¯è§¦å‘è‡ªåŠ¨å‘å¸ƒã€‚</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><div class="edit-info" data-v-d4a0bba5><div class="edit-link" data-v-d4a0bba5><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/LLMKira/Docs/edit/main/docs/dev/basic.md" target="_blank" rel="noreferrer" data-v-d4a0bba5><!--[--><span class="vpi-square-pen edit-link-icon" data-v-d4a0bba5></span> Edit On GitHub<!--]--></a></div><div class="last-updated" data-v-d4a0bba5><p class="VPLastUpdated" data-v-d4a0bba5 data-v-7e05ebdb>Updated at: <time datetime="2024-04-29T13:50:19.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><!----></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/Docs/dev/arch" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>æ¶æ„ä»‹ç»</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Released under the GFDL License.</p><p class="copyright" data-v-e315a0ad>Copyright Â© 2022-present Kira</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"en_dev_client.md\":\"Db1HuZXF\",\"guide_command.md\":\"Dk11sHxU\",\"guide_getting-started.md\":\"CctWEGYW\",\"en_guide_command.md\":\"BizKrSqG\",\"dev_client.md\":\"sIYrJ8uM\",\"dev_basic.md\":\"681OQhEy\",\"index.md\":\"Ti_0qVNE\",\"guide_maintain.md\":\"CkHm5-Dv\",\"en_guide_getting-started.md\":\"wf9vgJEi\",\"en_guide_maintain.md\":\"Cu6Tuxnj\",\"en_guide_service.md\":\"D70vvW4s\",\"dev_arch.md\":\"BPp5nzK3\",\"en_dev_arch.md\":\"CFGyXUxf\",\"en_index.md\":\"BgMGvFfT\",\"guide_service.md\":\"esD99RYd\",\"en_dev_basic.md\":\"Chv-IMYf\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Openai Kira Org\",\"description\":\"Kira Kira Openaibot.\",\"base\":\"/Docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Deploy Guide\",\"link\":\"/guide/getting-started\",\"activeMatch\":\"/guide/\"},{\"text\":\"Dev Tutorials\",\"link\":\"/dev/basic\",\"activeMatch\":\"/dev/\"},{\"text\":\"About Repo\",\"items\":[{\"text\":\"Changelog\",\"link\":\"https://github.com/LLMKira/Openaibot/pulls?q=\"}]}],\"siteTitle\":\"LLMKira\",\"logo\":\"https://avatars.githubusercontent.com/u/124290462?s=200&v=4\",\"sidebar\":{\"/guide/\":[{\"text\":\"éƒ¨ç½²æŒ‡å—\",\"collapsed\":false,\"items\":[{\"text\":\"å¼€å§‹éƒ¨ç½²\",\"link\":\"/guide/getting-started\"},{\"text\":\"å­æœåŠ¡éƒ¨ä»¶\",\"link\":\"/guide/service\"},{\"text\":\"ç»´æŠ¤æœåŠ¡\",\"link\":\"/guide/maintain\"}]},{\"text\":\"ä½¿ç”¨æŒ‡å—\",\"collapsed\":false,\"items\":[{\"text\":\"äº¤äº’å‘½ä»¤\",\"link\":\"/guide/command\"}]}],\"/dev/\":[{\"text\":\"æ’ä»¶å¼€å‘æŒ‡å—\",\"items\":[{\"text\":\"å¿«é€Ÿå¼€å‘\",\"link\":\"/dev/basic\"}]},{\"text\":\"å¹³å°å¼€å‘æŒ‡å—\",\"items\":[{\"text\":\"æ¶æ„ä»‹ç»\",\"link\":\"/dev/arch\"},{\"text\":\"æ”¶å‘ç«¯\",\"link\":\"/dev/client\"}]}],\"/en/guide/\":[{\"text\":\"Deploy Guide\",\"collapsed\":false,\"items\":[{\"text\":\"Deploy\",\"link\":\"/en/guide/getting-started\"},{\"text\":\"Component\",\"link\":\"/en/guide/service\"},{\"text\":\"Maintain\",\"link\":\"/en/guide/maintain\"}]},{\"text\":\"Usage instructions\",\"collapsed\":false,\"items\":[{\"text\":\"Command\",\"link\":\"/en/guide/command\"}]}],\"/en/dev/\":[{\"text\":\"Plugin System\",\"items\":[{\"text\":\"Fast Dev\",\"link\":\"/en/dev/basic\"}]},{\"text\":\"Platform Dev\",\"items\":[{\"text\":\"Arch\",\"link\":\"/en/dev/arch\"},{\"text\":\"Client\",\"link\":\"/en/dev/client\"}]}]},\"editLink\":{\"pattern\":\"https://github.com/LLMKira/Docs/edit/main/docs/:path\",\"text\":\"Edit On GitHub\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/LLMKira/Openaibot\"}],\"footer\":{\"message\":\"Released under the GFDL License.\",\"copyright\":\"Copyright Â© 2022-present Kira\"},\"lastUpdated\":{\"text\":\"Updated at\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"outline\":[1,3]},\"locales\":{\"root\":{\"label\":\"Chinese\",\"lang\":\"zh\",\"link\":\"/\"},\"en\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"/en/\"}},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>